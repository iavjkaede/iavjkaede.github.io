<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>.NetCore Web é¡¹ç›®çš„æ’ä»¶å®ç° | å½’äº‘é˜</title><meta name="description" content="å‰è¨€ä¸ºä»€ä¹ˆä½¿ç”¨æ’ä»¶çš„æ–¹å¼å»å®Œæˆé¡¹ç›®ï¼Ÿå¹¶ä¸æ˜¯å› ä¸ºè¿™å¾ˆé…·ï¼Œä»…ä»…æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›é¡¹ç›®å˜å¾—æ›´å®¹æ˜“ç»´æŠ¤ï¼Œæ›´å®¹æ˜“æ‹“å±•ï¼Œå½¼æ­¤ä¹‹é—´çš„ä¾èµ–æ›´æ¸…æ™°æ›´ç®€å•ã€‚ä½¿ç”¨æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸å½±å“ç°æœ‰åŠŸèƒ½æƒ…å†µä¸‹å»å¼€å‘æ–°çš„åŠŸèƒ½ï¼Œéšæ„æ›¿æ¢ç°æœ‰çš„åŠŸèƒ½æ¨¡å—ï¼Œè¿é‡æ–°ç¼–è¯‘éƒ½ä¸éœ€è¦ã€‚çœ‹èµ·æ¥ç¡®å®æŒºé…·ï¼Œè¿™ä¹ˆé…·çš„åŠŸèƒ½ï¼Œåœ¨C#ä¸­å®ç°èµ·æ¥å´å¹¶ä¸å¤æ‚ã€‚å—¯ï¼Œé‚£å°±åˆ†äº«ä¸€ä¸‹æˆ‘åœ¨.NetCore é¡¹ç›®ä¸­ä½¿ç”¨æ’ä»¶çš„æ–¹å¼ã€‚ ç¯å¢ƒç®€ä»‹ç³»ç»Ÿç¯å¢ƒWindows 10 LTSC 2"><meta name="keywords" content="C#,Plugins"><meta name="author" content="æ½‡æ«11"><meta name="copyright" content="æ½‡æ«11"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content=".NetCore Web é¡¹ç›®çš„æ’ä»¶å®ç°"><meta name="twitter:description" content="å‰è¨€ä¸ºä»€ä¹ˆä½¿ç”¨æ’ä»¶çš„æ–¹å¼å»å®Œæˆé¡¹ç›®ï¼Ÿå¹¶ä¸æ˜¯å› ä¸ºè¿™å¾ˆé…·ï¼Œä»…ä»…æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›é¡¹ç›®å˜å¾—æ›´å®¹æ˜“ç»´æŠ¤ï¼Œæ›´å®¹æ˜“æ‹“å±•ï¼Œå½¼æ­¤ä¹‹é—´çš„ä¾èµ–æ›´æ¸…æ™°æ›´ç®€å•ã€‚ä½¿ç”¨æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸å½±å“ç°æœ‰åŠŸèƒ½æƒ…å†µä¸‹å»å¼€å‘æ–°çš„åŠŸèƒ½ï¼Œéšæ„æ›¿æ¢ç°æœ‰çš„åŠŸèƒ½æ¨¡å—ï¼Œè¿é‡æ–°ç¼–è¯‘éƒ½ä¸éœ€è¦ã€‚çœ‹èµ·æ¥ç¡®å®æŒºé…·ï¼Œè¿™ä¹ˆé…·çš„åŠŸèƒ½ï¼Œåœ¨C#ä¸­å®ç°èµ·æ¥å´å¹¶ä¸å¤æ‚ã€‚å—¯ï¼Œé‚£å°±åˆ†äº«ä¸€ä¸‹æˆ‘åœ¨.NetCore é¡¹ç›®ä¸­ä½¿ç”¨æ’ä»¶çš„æ–¹å¼ã€‚ ç¯å¢ƒç®€ä»‹ç³»ç»Ÿç¯å¢ƒWindows 10 LTSC 2"><meta name="twitter:image" content="https://image.zsver.com/2020/05/23/67597c6252dd0.jpg"><meta property="og:type" content="article"><meta property="og:title" content=".NetCore Web é¡¹ç›®çš„æ’ä»¶å®ç°"><meta property="og:url" content="http://blog.iavjkaede.com/2020/05/18/NetCore%20Web%20Plugins/"><meta property="og:site_name" content="å½’äº‘é˜"><meta property="og:description" content="å‰è¨€ä¸ºä»€ä¹ˆä½¿ç”¨æ’ä»¶çš„æ–¹å¼å»å®Œæˆé¡¹ç›®ï¼Ÿå¹¶ä¸æ˜¯å› ä¸ºè¿™å¾ˆé…·ï¼Œä»…ä»…æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›é¡¹ç›®å˜å¾—æ›´å®¹æ˜“ç»´æŠ¤ï¼Œæ›´å®¹æ˜“æ‹“å±•ï¼Œå½¼æ­¤ä¹‹é—´çš„ä¾èµ–æ›´æ¸…æ™°æ›´ç®€å•ã€‚ä½¿ç”¨æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸å½±å“ç°æœ‰åŠŸèƒ½æƒ…å†µä¸‹å»å¼€å‘æ–°çš„åŠŸèƒ½ï¼Œéšæ„æ›¿æ¢ç°æœ‰çš„åŠŸèƒ½æ¨¡å—ï¼Œè¿é‡æ–°ç¼–è¯‘éƒ½ä¸éœ€è¦ã€‚çœ‹èµ·æ¥ç¡®å®æŒºé…·ï¼Œè¿™ä¹ˆé…·çš„åŠŸèƒ½ï¼Œåœ¨C#ä¸­å®ç°èµ·æ¥å´å¹¶ä¸å¤æ‚ã€‚å—¯ï¼Œé‚£å°±åˆ†äº«ä¸€ä¸‹æˆ‘åœ¨.NetCore é¡¹ç›®ä¸­ä½¿ç”¨æ’ä»¶çš„æ–¹å¼ã€‚ ç¯å¢ƒç®€ä»‹ç³»ç»Ÿç¯å¢ƒWindows 10 LTSC 2"><meta property="og:image" content="https://image.zsver.com/2020/05/23/67597c6252dd0.jpg"><meta property="article:published_time" content="2020-05-18T15:22:37.125Z"><meta property="article:modified_time" content="2020-07-13T16:05:06.849Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://blog.iavjkaede.com/2020/05/18/NetCore%20Web%20Plugins/"><link rel="prev" title="NetCore ä½¿ç”¨ ImageSharp ä¸ºå›¾ç‰‡æ·»åŠ æ°´å°" href="http://blog.iavjkaede.com/2020/05/18/NetCore%20ImageSharp%20Watermark/"><link rel="next" title=".Net ä¸­MimeType çš„è·å–" href="http://blog.iavjkaede.com/2020/05/18/Get%20MimeType%20via%20.NET/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  bookmark: {
    message_prev: 'æŒ‰',
    message_next: 'é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾'
  },
  runtime_unit: 'å¤©',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="å½’äº‘é˜" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length_num">10</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length_num">16</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length_num">2</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> å½’äº‘</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> å¾¡é£</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å¿˜å°˜</span></a></div></div></div></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç¯å¢ƒç®€ä»‹"><span class="toc-number">2.</span> <span class="toc-text">ç¯å¢ƒç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ç³»ç»Ÿç¯å¢ƒ"><span class="toc-number">2.1.</span> <span class="toc-text">ç³»ç»Ÿç¯å¢ƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¼€å‘ç¯å¢ƒ"><span class="toc-number">2.2.</span> <span class="toc-text">å¼€å‘ç¯å¢ƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¼€å‘å·¥å…·"><span class="toc-number">2.3.</span> <span class="toc-text">å¼€å‘å·¥å…·</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å‡†å¤‡"><span class="toc-number">3.</span> <span class="toc-text">å‡†å¤‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#é¡¹ç›®å‡†å¤‡"><span class="toc-number">3.1.</span> <span class="toc-text">é¡¹ç›®å‡†å¤‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ•°æ®åº“å‡†å¤‡"><span class="toc-number">3.2.</span> <span class="toc-text">æ•°æ®åº“å‡†å¤‡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¼€å§‹"><span class="toc-number">4.</span> <span class="toc-text">å¼€å§‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#åŠ è½½Controller"><span class="toc-number">4.1.</span> <span class="toc-text">åŠ è½½Controller</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¿®æ”¹Startup-cs"><span class="toc-number">4.1.1.</span> <span class="toc-text">ä¿®æ”¹Startup.cs*</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æ·»åŠ PluginController-cs"><span class="toc-number">4.1.2.</span> <span class="toc-text">æ·»åŠ PluginController.cs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ç¼–å†™tasks-json"><span class="toc-number">4.1.3.</span> <span class="toc-text">ç¼–å†™tasks.json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å¯åŠ¨"><span class="toc-number">4.1.4.</span> <span class="toc-text">å¯åŠ¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ³¨å…¥Services"><span class="toc-number">4.2.</span> <span class="toc-text">æ³¨å…¥Services</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ç”¨æ¥æ³¨å…¥çš„æ¥å£"><span class="toc-number">4.2.1.</span> <span class="toc-text">ç”¨æ¥æ³¨å…¥çš„æ¥å£*</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å®Œæˆæ³¨å…¥"><span class="toc-number">4.2.2.</span> <span class="toc-text">å®Œæˆæ³¨å…¥*</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ç¼–å†™Serviceè¿›è¡Œæµ‹è¯•"><span class="toc-number">4.2.3.</span> <span class="toc-text">ç¼–å†™Serviceè¿›è¡Œæµ‹è¯•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å¯åŠ¨-1"><span class="toc-number">4.2.4.</span> <span class="toc-text">å¯åŠ¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç‹¬ç«‹é…ç½®æ–‡ä»¶"><span class="toc-number">4.3.</span> <span class="toc-text">ç‹¬ç«‹é…ç½®æ–‡ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ServicesRegister-csä¸­é…Config"><span class="toc-number">4.3.1.</span> <span class="toc-text">ServicesRegister.csä¸­é…Config*</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Plugin1Config-cs"><span class="toc-number">4.3.2.</span> <span class="toc-text">Plugin1Config.cs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æ·»åŠ é…ç½®æ–‡ä»¶"><span class="toc-number">4.3.3.</span> <span class="toc-text">æ·»åŠ é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æµ‹è¯•é…ç½®"><span class="toc-number">4.3.4.</span> <span class="toc-text">æµ‹è¯•é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å†æ¬¡å¯åŠ¨"><span class="toc-number">4.3.5.</span> <span class="toc-text">å†æ¬¡å¯åŠ¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ˜ å°„Model"><span class="toc-number">4.4.</span> <span class="toc-text">æ˜ å°„Model</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#æ•°æ®åº“è¡¨ç»“æ„"><span class="toc-number">4.4.1.</span> <span class="toc-text">æ•°æ®åº“è¡¨ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#é…ç½®æ•°æ®åº“ä¸Šä¸‹æ–‡"><span class="toc-number">4.4.2.</span> <span class="toc-text">é…ç½®æ•°æ®åº“ä¸Šä¸‹æ–‡*</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æ˜ å°„Model-å¹¶å®ç°-IEntiyTypeConfigration"><span class="toc-number">4.4.3.</span> <span class="toc-text">æ˜ å°„Model å¹¶å®ç° IEntiyTypeConfigration*</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æ³¨å…¥æ•°æ®åº“ä¸Šä¸‹æ–‡"><span class="toc-number">4.4.4.</span> <span class="toc-text">æ³¨å…¥æ•°æ®åº“ä¸Šä¸‹æ–‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æµ‹è¯•æ•°æ®åº“ä¸Šä¸‹æ–‡"><span class="toc-number">4.4.5.</span> <span class="toc-text">æµ‹è¯•æ•°æ®åº“ä¸Šä¸‹æ–‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#åˆåˆå¯åŠ¨"><span class="toc-number">4.4.6.</span> <span class="toc-text">åˆåˆå¯åŠ¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æœ€å"><span class="toc-number">5.</span> <span class="toc-text">æœ€å</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2020å¹´7æœˆ14æ—¥-æ›´"><span class="toc-number">6.</span> <span class="toc-text">2020å¹´7æœˆ14æ—¥ æ›´</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://image.zsver.com/2020/05/23/67597c6252dd0.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">å½’äº‘é˜</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> å½’äº‘</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> å¾¡é£</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å¿˜å°˜</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">.NetCore Web é¡¹ç›®çš„æ’ä»¶å®ç°</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="å‘è¡¨äº 2020-05-18 23:22:37"><i class="fa fa-calendar" aria-hidden="true"></i> å‘è¡¨äº 2020-05-18</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="æ›´æ–°äº 2020-07-14 00:05:06"><i class="fa fa-history" aria-hidden="true"></i> æ›´æ–°äº 2020-07-14</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/NET/">.NET</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸ºä»€ä¹ˆä½¿ç”¨æ’ä»¶çš„æ–¹å¼å»å®Œæˆé¡¹ç›®ï¼Ÿå¹¶ä¸æ˜¯å› ä¸ºè¿™å¾ˆé…·ï¼Œä»…ä»…æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›é¡¹ç›®å˜å¾—æ›´å®¹æ˜“ç»´æŠ¤ï¼Œæ›´å®¹æ˜“æ‹“å±•ï¼Œå½¼æ­¤ä¹‹é—´çš„ä¾èµ–æ›´æ¸…æ™°æ›´ç®€å•ã€‚ä½¿ç”¨æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸å½±å“ç°æœ‰åŠŸèƒ½æƒ…å†µä¸‹å»å¼€å‘æ–°çš„åŠŸèƒ½ï¼Œéšæ„æ›¿æ¢ç°æœ‰çš„åŠŸèƒ½æ¨¡å—ï¼Œè¿é‡æ–°ç¼–è¯‘éƒ½ä¸éœ€è¦ã€‚çœ‹èµ·æ¥ç¡®å®æŒºé…·ï¼Œè¿™ä¹ˆé…·çš„åŠŸèƒ½ï¼Œåœ¨C#ä¸­å®ç°èµ·æ¥å´å¹¶ä¸å¤æ‚ã€‚å—¯ï¼Œé‚£å°±åˆ†äº«ä¸€ä¸‹æˆ‘åœ¨.NetCore é¡¹ç›®ä¸­ä½¿ç”¨æ’ä»¶çš„æ–¹å¼ã€‚</p>
<h2 id="ç¯å¢ƒç®€ä»‹"><a href="#ç¯å¢ƒç®€ä»‹" class="headerlink" title="ç¯å¢ƒç®€ä»‹"></a>ç¯å¢ƒç®€ä»‹</h2><h3 id="ç³»ç»Ÿç¯å¢ƒ"><a href="#ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒ"></a>ç³»ç»Ÿç¯å¢ƒ</h3><p>Windows 10 LTSC 2019</p>
<h3 id="å¼€å‘ç¯å¢ƒ"><a href="#å¼€å‘ç¯å¢ƒ" class="headerlink" title="å¼€å‘ç¯å¢ƒ"></a>å¼€å‘ç¯å¢ƒ</h3><p>SDKï¼š .NetCore 2.2</p>
<p>Databaseï¼šSQLite 3</p>
<h3 id="å¼€å‘å·¥å…·"><a href="#å¼€å‘å·¥å…·" class="headerlink" title="å¼€å‘å·¥å…·"></a>å¼€å‘å·¥å…·</h3><p>Editorï¼šVisual Studio Code</p>
<p>Shellï¼šPowershell</p>
<h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><h3 id="é¡¹ç›®å‡†å¤‡"><a href="#é¡¹ç›®å‡†å¤‡" class="headerlink" title="é¡¹ç›®å‡†å¤‡"></a>é¡¹ç›®å‡†å¤‡</h3><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å»åˆ›å»ºä»¥ä¸‹é¡¹ç›®ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mkdir PluginDemo</span><br><span class="line">cd PluginDemo</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿è¯ä½¿ç”¨çš„æ˜¯2.2ç‰ˆæœ¬çš„.netcore sdk</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨ dotnet --list-sdks æŸ¥çœ‹å·²å®‰è£…çš„.netcore ç‰ˆæœ¬</span></span><br><span class="line">dotnet new global.json -<span class="literal">-sdk</span><span class="literal">-version</span> <span class="number">2.2</span>.<span class="number">204</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé¡¹ç›®</span></span><br><span class="line">dotnet new web <span class="literal">-o</span> Host</span><br><span class="line">dotnet new classlib <span class="literal">-o</span> Share</span><br><span class="line">dotnet new classlib <span class="literal">-o</span> Plugin1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å¼•ç”¨</span></span><br><span class="line">dotnet add .\Host\ reference .\Share\</span><br><span class="line">dotnet add .\Plugin1\ reference .\Share\</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ VS Code ä¸­æ‰“å¼€</span></span><br><span class="line">code ./</span><br></pre></td></tr></table></figure>

<p>æŒ‰ä¸‹<code>F5</code>è¿›è¡Œè°ƒè¯•ï¼Œä¿è¯é¡¹ç›®æˆåŠŸå¯åŠ¨ã€‚</p>
<p>è¿™é‡Œåˆ›å»ºäº†ä¸‰ä¸ªé¡¹ç›®ï¼Œåˆ†åˆ«æ˜¯<strong>Host</strong>ã€<strong>Plugin1</strong>ã€<strong>Share</strong>ï¼Œä¾èµ–å…³ç³»å¦‚ä¸‹</p>
<p>Host &lt;- Share</p>
<p>Plugin1 &lt;- Share</p>
<h3 id="æ•°æ®åº“å‡†å¤‡"><a href="#æ•°æ®åº“å‡†å¤‡" class="headerlink" title="æ•°æ®åº“å‡†å¤‡"></a>æ•°æ®åº“å‡†å¤‡</h3><p>åœ¨çœŸæ­£å¼€å§‹ä¹‹å‰ï¼Œæœ€å¥½éƒ¨ç½²ä¸€ä¸ªå¯ç”¨çš„æ•°æ®åº“ï¼Œå› ä¸ºåé¢çš„Modelæ˜ å°„ä¼šç”¨åˆ°ã€‚</p>
<h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><p>å‡†å¤‡å¥½äº†å—ï¼Ÿå‡†å¤‡å¥½é‚£å¯å°±å¼€å§‹äº†ã€‚ğŸš€</p>
<h3 id="åŠ è½½Controller"><a href="#åŠ è½½Controller" class="headerlink" title="åŠ è½½Controller"></a>åŠ è½½Controller</h3><p>é¦–å…ˆè¦åšåˆ°çš„ä¸€ç‚¹å°±æ˜¯ï¼ŒæŠŠç¼–å†™çš„ç¨‹åºé›†ï¼ˆå…¶ä¸­åŒ…å«ç»§æ‰¿è‡ªControllerçš„å­ç±»ï¼‰ä¸¢åˆ°å®šä¹‰çš„æ’ä»¶ç›®å½•ï¼Œé‡å¯åº”ç”¨åï¼Œç¨‹åºé›†ä¸­çš„Controllerèƒ½å¤Ÿè¢«æˆåŠŸè·¯ç”±ã€‚</p>
<p>åºŸè¯ä¸å¤šè¯´ï¼Œç”¨<strong>ApplicationPart</strong>æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<h4 id="ä¿®æ”¹Startup-cs"><a href="#ä¿®æ”¹Startup-cs" class="headerlink" title="ä¿®æ”¹Startup.cs*"></a>ä¿®æ”¹Startup.cs*</h4><p>é¡¹ç›® â€“ <strong>Host</strong></p>
<p>ç¼–è¾‘<strong>Startup.cs</strong> ä¸­çš„<code>ConfigureServices</code>æ–¹æ³•ä¸­ä½¿ç”¨ä»¥ä¸‹ä»£ç é…ç½®MVC</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    .....</span><br><span class="line"></span><br><span class="line">    services.AddMvc().ConfigureApplicationPartManager(manager =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">string</span> path = Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location);</span><br><span class="line">        <span class="keyword">var</span> assmeblyFiles = Directory.GetFiles (path, <span class="string">"*.dll"</span>);</span><br><span class="line">        assmeblyFiles.Select(AssemblyLoadContext.Default.LoadFromAssemblyPath)</span><br><span class="line">            .ToList().ForEach(assmebly =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (assmebly.GetTypes().Any(<span class="keyword">typeof</span>(Controller).IsAssignableFrom))</span><br><span class="line">                &#123;</span><br><span class="line">                        AssemblyPart part = <span class="keyword">new</span> AssemblyPart(assmebly);</span><br><span class="line">                        manager.ApplicationParts.Add(part);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    .....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">IApplicationBuilder app, IHostingEnvironment env</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (env.IsDevelopment())</span><br><span class="line">    &#123;</span><br><span class="line">        app.UseDeveloperExceptionPage();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    app.Run(async (context) =&gt;</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        await context.Response.WriteAsync("Hello World!");</span></span><br><span class="line"><span class="comment">    &#125;);*/</span></span><br><span class="line">    app.UseMvc();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€˜*.dllâ€™ å¯ä»¥ç”¨å¦‚ *.plugin.dll è¿™æ ·çš„å­—ç¬¦ä¸²ä»£æ›¿ï¼Œå–ä¸€ä¸ªæ’ä»¶å‘½åè§„åˆ™ã€‚æœ€å¥½æŠŠè¿™ä¸ªè§„åˆ™æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚</p>
<p>æ¥ä¸‹æ¥ç¼–å†™ä¸€ä¸ªControllerè¿›è¡Œæµ‹è¯•ã€‚</p>
<hr>
<p>é¡¹ç›® â€“ <strong>Plugin1</strong></p>
<h4 id="æ·»åŠ PluginController-cs"><a href="#æ·»åŠ PluginController-cs" class="headerlink" title="æ·»åŠ PluginController.cs"></a>æ·»åŠ <strong>PluginController.cs</strong></h4><p>!<strong>PluginController.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">ApiController</span>]</span><br><span class="line">    [<span class="meta">Route (<span class="meta-string">"api/[controller]/[action]"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PluginController</span> : <span class="title">Controller</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PluginController</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">Ping</span>(<span class="params"></span>)</span> =&gt; <span class="string">"pong"</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™å®Œä¹‹åè¿˜éœ€è¦æ·»åŠ MVCçš„NuGetåŒ…ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Plugin1\ package Microsoft.AspNetCore.Mvc</span><br></pre></td></tr></table></figure>

<p>å®ŒæˆNuGetåŒ…æ·»åŠ åå°±å¯ä»¥æ„å»ºPlugin1é¡¹ç›®äº†ã€‚</p>
<hr>
<h4 id="ç¼–å†™tasks-json"><a href="#ç¼–å†™tasks-json" class="headerlink" title="ç¼–å†™tasks.json"></a>ç¼–å†™tasks.json</h4><p>ç­‰ç­‰ï¼Œå¦‚æœä¸æƒ³æ¯æ¬¡éƒ½<code>dotnet build .\Plugin1\</code>ï¼Œè¿˜éœ€è¦é…ç½®ä¸‹<strong>tasks.json</strong></p>
<p>ç¬¬ä¸€æ¬¡<code>F5</code>è°ƒè¯•çš„æ—¶å€™ä¼šé…ç½®æ„å»ºä»»åŠ¡ç”Ÿæˆè¯¥æ–‡ä»¶ã€‚</p>
<p><strong>tasks.json</strong>ä¸­é»˜è®¤æ·»åŠ äº†ä¸‰ä¸ªä»»åŠ¡<code>buildï¼Œpublishï¼Œwatch</code>ï¼Œç°åœ¨æ·»åŠ <strong>Plugin1</strong>çš„æ„å»ºä»»åŠ¡ã€‚</p>
<p>ç¼–è¾‘<strong>tasks.json</strong> åŠ å…¥ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"label"</span>: <span class="string">"build plugin1"</span>,</span><br><span class="line">    <span class="attr">"command"</span>: <span class="string">"dotnet"</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"process"</span>,</span><br><span class="line">    <span class="attr">"args"</span>: [</span><br><span class="line">        <span class="string">"build"</span>,</span><br><span class="line">        <span class="string">"$&#123;workspaceFolder&#125;/Plugin1/Plugin1.csproj"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"problemMatcher"</span>: <span class="string">"$tsc"</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"label"</span>: <span class="string">"build &amp; install plugin1"</span>,</span><br><span class="line">    <span class="attr">"command"</span>: <span class="string">"cp"</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"shell"</span>,</span><br><span class="line">    <span class="attr">"args"</span>: [</span><br><span class="line">        <span class="string">"$&#123;workspaceFolder&#125;/Plugin1/bin/Debug/netstandard2.0/Plugin1.dll"</span>,</span><br><span class="line">        <span class="string">"$&#123;workspaceFolder&#125;/Host/bin/Debug/netcoreapp2.2/Plugin1.dll"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"windows"</span>: &#123;</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"xcopy"</span>,</span><br><span class="line">        <span class="attr">"args"</span>: [</span><br><span class="line">            <span class="string">"/y"</span>,</span><br><span class="line">            <span class="string">"$&#123;workspaceFolder&#125;\\Plugin1\\bin\\Debug\\netstandard2.0\\Plugin1.dll"</span>,</span><br><span class="line">            <span class="string">"$&#123;workspaceFolder&#125;\\Host\\bin\\Debug\\netcoreapp2.2\\Plugin1.dll"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"dependsOn"</span>: [</span><br><span class="line">        <span class="string">"build plugin1"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"problemMatcher"</span>: <span class="string">"$tsc"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨VS Codeä¸­æ‰§è¡Œä»»åŠ¡<strong>build &amp; install plugin1</strong></p>
<p><code>ctrl+shift+p</code>  è¾“å…¥ <code>run task</code> é€‰æ‹© <code>build &amp; install plugin1</code></p>
<p><em>æ³¨æ„ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œå‘½ä»¤å¯èƒ½ä¼šè¯¢é—®æ˜¯å¤åˆ¶çš„æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹ï¼Œåœ¨ä»»åŠ¡ç»ˆç«¯ä¸­ï¼Œè¾“å…¥<code>F</code>ç¡®å®šæ˜¯æ–‡ä»¶å³å¯ã€‚</em></p>
<p>æ‰§è¡ŒæˆåŠŸååœ¨<strong>Host</strong>çš„<code>bin/Debug/netcoreapp2.2</code>ç›®å½•ä¸‹ç„ä¸€çœ¼æœ‰æ²¡æœ‰Plugin1.dllï¼Œæœ‰çš„è¯å°±ğŸ‘Œã€‚</p>
<hr>
<h4 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h4><p><code>F5</code>å¯åŠ¨é¡¹ç›®ï¼Œç„¶ååœ¨æµè§ˆå™¨è¾“å…¥ <a href="https://5001/api/plugin/pingã€‚" target="_blank" rel="noopener">https://5001/api/plugin/pingã€‚</a></p>
<p>å½“çœ‹åˆ°æµè§ˆå™¨å›å¤äº†ä¸€ä¸ªâ€™pongâ€™ ä¹‹åï¼Œæ„å‘³ç€ï¼ŒæˆåŠŸäº†ğŸ˜€ã€‚</p>
<h3 id="æ³¨å…¥Services"><a href="#æ³¨å…¥Services" class="headerlink" title="æ³¨å…¥Services"></a>æ³¨å…¥Services</h3><p>Plugin1.dll é™¤äº†éœ€è¦å“åº”è¯·æ±‚ä¹‹å¤–ï¼Œå®ƒè¿˜éœ€è¦ä½¿ç”¨IOCå®¹å™¨è¿›è¡ŒDIã€‚.NetCore å·²ç»å†…ç½®äº†IOCå®¹å™¨ï¼Œéœ€è¦è§£å†³çš„é—®é¢˜å°±æ˜¯ï¼šæ€ä¹ˆæŠŠè¿™ä¸ªå®¹å™¨ä¼ é€’ç»™æ’ä»¶ğŸ¤”ã€‚è¿™é‡Œä½¿ç”¨åå°„æ¥å®Œæˆå®ƒã€‚</p>
<p>æ€è·¯æ˜¯è¿™æ ·ï¼Œå®šä¹‰ä¸€ä¸ªç”¨æ¥æ³¨å…¥æœåŠ¡çš„æ¥å£ã€‚åœ¨<strong>Host</strong>é¡¹ç›®ä¸­ï¼Œéœ€è¦éå†æ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç¨‹åºé›†å¹¶è°ƒç”¨æ³¨å…¥æ–¹æ³•ï¼Œç„¶ååœ¨æ’ä»¶é¡¹ç›®ä¸­å®ç°è¯¥æ¥å£ã€‚å½“ç„¶ï¼Œè¿™ä¸ªæ¥å£éœ€è¦æ”¾åœ¨<strong>Share</strong>é¡¹ç›®ä¸­ã€‚</p>
<h4 id="ç”¨æ¥æ³¨å…¥çš„æ¥å£"><a href="#ç”¨æ¥æ³¨å…¥çš„æ¥å£" class="headerlink" title="ç”¨æ¥æ³¨å…¥çš„æ¥å£*"></a>ç”¨æ¥æ³¨å…¥çš„æ¥å£*</h4><p>é¡¹ç›® â€“ <strong>Share</strong></p>
<p>åœ¨VS Code ä¸­æ–°å»º<strong>IServicesRegister.cs</strong></p>
<p>!<strong>IServicesRegister.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Share</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IServicesRegister</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">RegisterServices</span>(<span class="params">IServiceCollection services</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿˜éœ€è¦æ·»åŠ <strong>Microsoft.Extensions.DependencyInjection</strong> NuGet åŒ…ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Share\ package Microsoft.Extensions.DependencyInjection</span><br></pre></td></tr></table></figure>

<p><em>å‘½ä»¤æ˜¯åœ¨<strong>PluginDemo</strong> è·¯å¾„ä¸‹æ‰§è¡Œçš„ï¼Œå¯ä¸è¦æ··äº†ã€‚</em></p>
<p>è¿™ä¸ªæ¥å£æå…¶ç®€å•ï¼Œåªæœ‰ä¸€ä¸ª<code>RegisterServices</code>çš„æ–¹æ³•ï¼Œæˆ‘è¿™é‡Œä¿è¯è¿™ä¸ªæ¥å£æœ‰ä¸”åªæœ‰è¿™ä¸€ä¸ªæ–¹æ³•ï¼Œæ–¹ä¾¿å¾…ä¼šèƒ½æ‰¾åˆ°å®ƒã€‚</p>
<hr>
<h4 id="å®Œæˆæ³¨å…¥"><a href="#å®Œæˆæ³¨å…¥" class="headerlink" title="å®Œæˆæ³¨å…¥*"></a>å®Œæˆæ³¨å…¥*</h4><p>ç°åœ¨åœ¨<strong>Startup.cs</strong>ä¸­æ·»åŠ ä¸€ä¸ª<code>RegisterServices</code>æ–¹æ³•ï¼ˆåå­—æ˜¯å’Œæ¥å£çš„é‡å¤çš„ï¼Œè¿™æ²¡å…³ç³»ï¼Œä¸è¦æ··æ·†äº†å³å¯ï¼‰,æˆ–è€…å¯ä»¥ç›´æ¥<code>ConfigureServices</code> ä¸­æ“ä½œã€‚</p>
<p>!<strong>Startup.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// æœ€å¥½æ˜¯åœ¨æœ€åä¸€æ­¥å»æ³¨å…¥è¿™äº›æœåŠ¡</span></span><br><span class="line">    RegisterServices(services);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegisterServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾dllæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">var</span> dllFiles = Directory.GetFiles(Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location), <span class="string">"*.dll"</span>);</span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾ç¨‹åºé›†</span></span><br><span class="line">    <span class="keyword">var</span> assemblies = dllFiles.Select(AssemblyLoadContext.Default.LoadFromAssemblyPath).ToList();</span><br><span class="line">    assemblies.ForEach(ass =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è·å–å®ç°IServiceRegister æ¥å£çš„ç±»å‹</span></span><br><span class="line">        <span class="keyword">var</span> registers = ass.GetTypes().Where(m =&gt; m.IsClass &amp;&amp; <span class="keyword">typeof</span>(IServicesRegister).IsAssignableFrom(m)).ToList();</span><br><span class="line">        registers.ForEach(reg =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> instance = Activator.CreateInstance(reg);</span><br><span class="line">            <span class="comment">// æ–¹æ³• ä¿è¯è¯¥æ¥å£ä»…æœ‰ä¸€ä¸ªæ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨SingleOrDefaultï¼Œåº”è¯¥ç”¨Singleã€‚</span></span><br><span class="line">            <span class="keyword">var</span> method = <span class="keyword">typeof</span>(IServicesRegister).GetMethods().SingleOrDefault();</span><br><span class="line"></span><br><span class="line">            method.Invoke(instance, <span class="keyword">new</span> <span class="keyword">object</span>[]</span><br><span class="line">            &#123;</span><br><span class="line">                services</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="ç¼–å†™Serviceè¿›è¡Œæµ‹è¯•"><a href="#ç¼–å†™Serviceè¿›è¡Œæµ‹è¯•" class="headerlink" title="ç¼–å†™Serviceè¿›è¡Œæµ‹è¯•"></a>ç¼–å†™Serviceè¿›è¡Œæµ‹è¯•</h4><p>é¡¹ç›® â€“ <strong>Plugin1</strong></p>
<p>éœ€è¦æ·»åŠ ä¸‰ä¸ªæ–‡ä»¶</p>
<ul>
<li>ServicesRegister.cs</li>
<li>IAddService.cs</li>
<li>AddService.cs</li>
</ul>
<p><strong>ServicesRegister.cs</strong> ç”¨æ¥å®ç°æ³¨å…¥ï¼Œ<strong>AddService.cs</strong> å°†å®ç° IAddService æ¥å£ç”¨æ¥æµ‹è¯•ã€‚</p>
<p>!<strong>ServicesRegister.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"><span class="keyword">using</span> Share;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ServicesRegister</span> : <span class="title">IServicesRegister</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegisterServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Debug.WriteLine(<span class="string">"Register plugin1's services"</span>, <span class="string">"info: "</span>);</span><br><span class="line"></span><br><span class="line">            services.AddTransient&lt;IAddService,AddService&gt;();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>!<strong>IAddService.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IAddService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">string</span> <span class="title">Add</span>(<span class="params"><span class="keyword">string</span> a, <span class="keyword">string</span> b</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>!<strong>AddService.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AddService</span> : <span class="title">IAddService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">Add</span>(<span class="params"><span class="keyword">string</span> a, <span class="keyword">string</span> b</span>)</span> =&gt; a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åä¿®æ”¹<strong>PluginController.cs</strong> æ·»åŠ AddServiceçš„æ³¨å…¥ä¾èµ–å’Œæµ‹è¯•æ–¹æ³•ã€‚</p>
<p>!<strong>PluginController.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">ApiController</span>]</span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">"api/[controller]/[action]"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PluginController</span> : <span class="title">Controller</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">readonly</span> IAddService m_addService;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PluginController</span>(<span class="params">IAddService addService</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_addService = addService;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">Ping</span>(<span class="params"></span>)</span> =&gt; <span class="string">"pong"</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">PingService</span>(<span class="params"><span class="keyword">string</span> a, <span class="keyword">string</span> b</span>)</span> =&gt; m_addService.Add(a, b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="å¯åŠ¨-1"><a href="#å¯åŠ¨-1" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h4><p>å…ˆæ‰§è¡Œ <code>build &amp; install plugin1</code>å‘½ä»¤ï¼Œç„¶å<code>F5</code>å¯åŠ¨ã€‚ğŸš€</p>
<p>ä¸€åˆ‡å®Œæˆï¼Œåœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ <a href="https://localhost:5001/api/plugin/pingservice?a=service&amp;b=doneã€‚" target="_blank" rel="noopener">https://localhost:5001/api/plugin/pingservice?a=service&amp;b=doneã€‚</a></p>
<p>çœ‹çœ‹æµè§ˆå™¨å“åº”ï¼Œæ˜¯å¦æŠŠâ€™serviceâ€™ å’Œ â€˜doneâ€™ æ‹¼åˆ°ä¸€èµ·äº†å‘¢ã€‚</p>
<p>å†å»è°ƒè¯•æ§åˆ¶å°çœ‹æ‰“å°çš„<code>Debug.WriteLine(&quot;Register plugin1&#39;s services&quot;, &quot;info: &quot;);</code> æœ‰æ²¡æœ‰æ­£ç¡®è¾“å‡ºã€‚ğŸ‘ğŸ‘ğŸ‘</p>
<h3 id="ç‹¬ç«‹é…ç½®æ–‡ä»¶"><a href="#ç‹¬ç«‹é…ç½®æ–‡ä»¶" class="headerlink" title="ç‹¬ç«‹é…ç½®æ–‡ä»¶"></a>ç‹¬ç«‹é…ç½®æ–‡ä»¶</h3><p>å½“å†³å®šè®©æ’ä»¶æˆä¸ºä¸€ä¸ªå®Œæ•´ç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—æ—¶ï¼Œæ’ä»¶åº”è¯¥ä½¿ç”¨ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®è¿‡ç¨‹å’Œæ™®é€šçš„é¡¹ç›®é…ç½®æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œè¿™é‡Œå°±ç®€å•è®²ä¸€ä¸‹ã€‚</p>
<p>é¡¹ç›® â€“ <strong>Plugin1</strong></p>
<p>æ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶</p>
<ul>
<li>plugin1.json</li>
<li>Plugin1Config.cs</li>
</ul>
<h4 id="ServicesRegister-csä¸­é…Config"><a href="#ServicesRegister-csä¸­é…Config" class="headerlink" title="ServicesRegister.csä¸­é…Config*"></a><strong>ServicesRegister.cs</strong>ä¸­é…Config*</h4><p>ä¿®æ”¹<strong>ServicesRegister.cs</strong> ä¸­ æ–¹æ³•  <em>RegisterServices</em>  å¦‚ä¸‹</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ServicesRegister</span> : <span class="title">IServicesRegister</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegisterServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line"><span class="function"></span>       &#123;</span><br><span class="line">           Debug.WriteLine(<span class="string">"Register plugin1's services"</span>, <span class="string">"info: "</span>);</span><br><span class="line">           <span class="comment">// è·¯å¾„å¯ä»¥è‡ªè¡Œé…ç½®</span></span><br><span class="line">           <span class="keyword">var</span> config = <span class="keyword">new</span> ConfigurationBuilder()</span><br><span class="line">               .SetBasePath(Directory.GetCurrentDirectory())</span><br><span class="line">               .AddJsonFile(<span class="string">"plugin1.json"</span>, <span class="literal">false</span>)</span><br><span class="line">               .Build();</span><br><span class="line"></span><br><span class="line">           services.Configure&lt;Plugin1Config&gt;(config.GetSection(<span class="keyword">nameof</span>(Plugin1Config)));</span><br><span class="line"></span><br><span class="line">           services.AddTransient&lt;IAddService, AddService&gt;();</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="Plugin1Config-cs"><a href="#Plugin1Config-cs" class="headerlink" title="Plugin1Config.cs"></a>Plugin1Config.cs</h4><p>!<strong>Plugin1Config.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Plugin1Config</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Name</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Version</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Author</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ·»åŠ é…ç½®æ–‡ä»¶"><a href="#æ·»åŠ é…ç½®æ–‡ä»¶" class="headerlink" title="æ·»åŠ é…ç½®æ–‡ä»¶"></a>æ·»åŠ é…ç½®æ–‡ä»¶</h4><p>!<strong>plugin1.json</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"Plugin1Config"</span>:&#123;</span><br><span class="line">        <span class="attr">"Name"</span>:<span class="string">"Plugin1"</span>,</span><br><span class="line">        <span class="attr">"Version"</span>:<span class="string">"1.1"</span>,</span><br><span class="line">        <span class="attr">"Author"</span>:<span class="string">"Your Name"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æƒ³è¦æˆåŠŸæ„å»º<strong>Plugin1</strong>é¡¹ç›®è¿˜éœ€è¦æ·»åŠ ä»¥ä¸‹NuGetåŒ…</p>
<ul>
<li>Microsoft.Extensions.Configuration</li>
<li>Microsoft.Extensions.Configuration.FileExtensions</li>
<li>Microsoft.Extensions.Configuration.Json</li>
<li>Microsoft.Extensions.Options.ConfigurationExtensions</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Plugin1\ package  Microsoft.Extensions.Configuration</span><br><span class="line">dotnet add .\Plugin1\ package  Microsoft.Extensions.Configuration.FileExtensions</span><br><span class="line">dotnet add .\Plugin1\ package  Microsoft.Extensions.Configuration.Json</span><br><span class="line">dotnet add .\Plugin1\ package  Microsoft.Extensions.Options.ConfigurationExtensions</span><br></pre></td></tr></table></figure>

<hr>
<p>é¡¹ç›® â€“ <strong>Host</strong></p>
<p>å¦å¤– ï¼Œ<strong>Host</strong> ä¸­è¿˜éœ€è¦åœ¨<strong>Startup.cs</strong>æ–‡ä»¶ <em>ConfigureServices</em>  æ–¹æ³•ä¸­åŠ ä¸Šä¸€è¡Œ</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">services.AddOptions();</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="æµ‹è¯•é…ç½®"><a href="#æµ‹è¯•é…ç½®" class="headerlink" title="æµ‹è¯•é…ç½®"></a>æµ‹è¯•é…ç½®</h4><p>emmmï¼ŒControllerçš„ä»£ç çœ‹èµ·æ¥æ˜¯è¿™æ ·ã€‚</p>
<p>!<strong>PluginController.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.Options;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">ApiController</span>]</span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">"api/[controller]/[action]"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PluginController</span> : <span class="title">Controller</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">readonly</span> IAddService m_addService;</span><br><span class="line">        <span class="keyword">readonly</span> Plugin1Config m_config;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PluginController</span>(<span class="params">IAddService addService, IOptions&lt;Plugin1Config&gt; options</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_addService = addService;</span><br><span class="line">            m_config = options.Value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">Ping</span>(<span class="params"></span>)</span> =&gt; <span class="string">"pong"</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">PingService</span>(<span class="params"><span class="keyword">string</span> a, <span class="keyword">string</span> b</span>)</span> =&gt; m_addService.Add(a, b);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ActionResult&lt;Plugin1Config&gt; <span class="title">PingConfig</span>(<span class="params"></span>)</span> =&gt; m_config;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ NuGetå¼•ç”¨</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Plugin1\ package  Microsoft.Extensions.Options</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="å†æ¬¡å¯åŠ¨"><a href="#å†æ¬¡å¯åŠ¨" class="headerlink" title="å†æ¬¡å¯åŠ¨"></a>å†æ¬¡å¯åŠ¨</h4><p>ç°åœ¨åƒä¹‹å‰é‚£æ ·æ„å»ºé¡¹ç›®ï¼Œåœ¨å¯åŠ¨é¡¹ç›®ä¹‹å‰ï¼ŒæŠŠ<strong>Plugin1</strong>çš„é…ç½®æ–‡ä»¶<strong>plugin1.json</strong>æ‹·è´åˆ°<strong>Host</strong>ç›®å½•ä¸‹ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œæˆ‘é…ç½®çš„æ˜¯å½“å‰ç›®å½•</span></span><br><span class="line"><span class="keyword">var</span> config = <span class="keyword">new</span> ConfigurationBuilder()</span><br><span class="line">                .SetBasePath(Directory.GetCurrentDirectory())</span><br><span class="line">                .AddJsonFile(<span class="string">"plugin1.json"</span>, <span class="literal">false</span>)</span><br><span class="line">                .Build();</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨ä¹‹åï¼Œåœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥<a href="https://localhost:5001/api/plugin/pingconfigã€‚" target="_blank" rel="noopener">https://localhost:5001/api/plugin/pingconfigã€‚</a></p>
<p>çœ‹çœ‹æœ‰æ²¡æœ‰æ­£å¸¸è¯»å–åˆ°é…ç½®ã€‚ğŸ™‚</p>
<h3 id="æ˜ å°„Model"><a href="#æ˜ å°„Model" class="headerlink" title="æ˜ å°„Model"></a>æ˜ å°„Model</h3><p>åœ¨æ’ä»¶ä¸­å®ŒæˆæŸäº›æ‹“å±•åŠŸèƒ½æ—¶ï¼Œå¯èƒ½éœ€è¦æ•°æ®åº“çš„è¡¨ç»“æ„æ”¯æŒï¼Œä½†æ˜¯ï¼Œæˆ‘ä¸æƒ³æŠŠæ’ä»¶ä¸­çš„Modelæ”¾åˆ°<strong>Share</strong>é¡¹ç›®ä¸­ï¼Œæ’ä»¶åº”è¯¥è‡ªå·±ç®¡ç†è‡ªå·±çš„Modelã€‚ï¼ˆç©¶ç«Ÿæ˜¯æ”¾åœ¨Shareä¸­è¿˜æ˜¯æ”¾åœ¨æ’ä»¶é¡¹ç›®ä¸­ï¼Œå…·ä½“éœ€è¦çœ‹æ’ä»¶çš„å®šä½ï¼‰</p>
<p>éœ€è¦å‡†å¤‡ä¸€ä¸ªæ•°æ®åº“ç¯å¢ƒï¼Œæˆ‘è¿™é‡Œä½¿ç”¨SQLiteã€‚</p>
<h4 id="æ•°æ®åº“è¡¨ç»“æ„"><a href="#æ•°æ®åº“è¡¨ç»“æ„" class="headerlink" title="æ•°æ®åº“è¡¨ç»“æ„"></a>æ•°æ®åº“è¡¨ç»“æ„</h4><p>è¡¨å <em>t_plugdata</em></p>
<ul>
<li>Id</li>
<li>Name</li>
<li>Data</li>
</ul>
<p>ä»»æ„åŠ ä¸€äº›æ•°æ®è¿›å»ï¼Œæ¯”å¦‚</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Name</th>
<th>Data</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Ok</td>
<td>true</td>
</tr>
<tr>
<td>2</td>
<td>Pity</td>
<td>I am ok</td>
</tr>
<tr>
<td>3</td>
<td>Lisa</td>
<td>Hi,I am here</td>
</tr>
</tbody></table>
<p>ä¿è¯æœ‰ç‚¹æ•°æ®å°±å¥½äº†ï¼Œæœ‰å…³æ•°æ®åº“é“¾æ¥å­—ç¬¦ä¸²æˆ–è€…å…¶ä»–æ¶‰åŠçš„ä¸œè¥¿ä¸åœ¨è¿™é‡Œç»†è®²ã€‚</p>
<h4 id="é…ç½®æ•°æ®åº“ä¸Šä¸‹æ–‡"><a href="#é…ç½®æ•°æ®åº“ä¸Šä¸‹æ–‡" class="headerlink" title="é…ç½®æ•°æ®åº“ä¸Šä¸‹æ–‡*"></a>é…ç½®æ•°æ®åº“ä¸Šä¸‹æ–‡*</h4><p>é¡¹ç›® â€“ <strong>Share</strong></p>
<p>æ·»åŠ <strong>HostDbContext.cs</strong></p>
<p>ï¼<strong>HostDbContext.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.Loader;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Share</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HostDbContext</span> : <span class="title">DbContext</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">HostDbContext</span>(<span class="params">DbContextOptions options</span>) : <span class="title">base</span>(<span class="params">options</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnModelCreating</span>(<span class="params">ModelBuilder modelBuilder</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">base</span>.OnModelCreating(modelBuilder);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä¾æ—§æ˜¯ä½¿ç”¨åå°„çš„æ–¹å¼å»å®Œæˆ</span></span><br><span class="line">            <span class="keyword">var</span> dllfiles = Directory.GetFiles(Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location), <span class="string">"*.dll"</span>);</span><br><span class="line">            Array.ForEach(dllfiles, files =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> assembly = AssemblyLoadContext.Default.LoadFromAssemblyPath(files);</span><br><span class="line">                assembly.GetTypes().Where(type =&gt; type.GetInterface(<span class="keyword">typeof</span>(IEntityTypeConfiguration&lt;&gt;).FullName) != <span class="literal">null</span>)</span><br><span class="line">                    .ToList().ForEach(type =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">dynamic</span> instance = Activator.CreateInstance(type);</span><br><span class="line">                        modelBuilder.ApplyConfiguration(instance);</span><br><span class="line">                    &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnConfiguring</span>(<span class="params">DbContextOptionsBuilder optionsBuilder</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!optionsBuilder.IsConfigured)</span><br><span class="line">            &#123;</span><br><span class="line">                optionsBuilder.UseSqlite(<span class="string">"Data Source=./HostDb.db"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ„å»º<strong>Share</strong>é¡¹ç›®å¯èƒ½ç”¨åˆ°çš„NuGet åŒ…</p>
<ul>
<li>Microsoft.EntityFrameworkCore</li>
<li>Microsoft.EntityFrameworkCore.SQLite</li>
<li>System.Runtime.Loader</li>
<li>System.Linq</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Share\ package  Microsoft.EntityFrameworkCore</span><br><span class="line">dotnet add .\Share\ package  Microsoft.EntityFrameworkCore.SQLite</span><br><span class="line">dotnet add .\Share\ package  System.Runtime.Loader</span><br><span class="line">dotnet add .\Share\ package  System.Linq</span><br></pre></td></tr></table></figure>

<h4 id="æ˜ å°„Model-å¹¶å®ç°-IEntiyTypeConfigration"><a href="#æ˜ å°„Model-å¹¶å®ç°-IEntiyTypeConfigration" class="headerlink" title="æ˜ å°„Model å¹¶å®ç° IEntiyTypeConfigration*"></a>æ˜ å°„Model å¹¶å®ç° IEntiyTypeConfigration*</h4><p>é¡¹ç›® â€“ <strong>Plugin1</strong></p>
<p>æ·»åŠ æ–‡ä»¶ <strong>PluginData.cs</strong></p>
<p>ï¼<strong>PluginData.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.ComponentModel.DataAnnotations.Schema;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore.Metadata.Builders;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Table(<span class="meta-string">"t_plugdata"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PluginData</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Id</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Name</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Data</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class PluginDataConfig : IEntityTypeConfiguration&lt;PluginData&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">EntityTypeBuilder&lt;PluginData&gt; builder</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            builder.ToTable(<span class="string">"t_plugdata"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ„å»ºPlugin1 éœ€è¦æ·»åŠ çš„NuGet åŒ…</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Plugin1\ package  Microsoft.EntityFrameworkCore</span><br></pre></td></tr></table></figure>



<h4 id="æ³¨å…¥æ•°æ®åº“ä¸Šä¸‹æ–‡"><a href="#æ³¨å…¥æ•°æ®åº“ä¸Šä¸‹æ–‡" class="headerlink" title="æ³¨å…¥æ•°æ®åº“ä¸Šä¸‹æ–‡"></a>æ³¨å…¥æ•°æ®åº“ä¸Šä¸‹æ–‡</h4><p>é¡¹ç›® â€“ <strong>Host</strong></p>
<p><strong>Host</strong> ä¸­è¿˜éœ€è¦åœ¨<strong>Startup.cs</strong>æ–‡ä»¶ <em>ConfigureServices</em>  æ–¹æ³•ä¸­åŠ ä¸Šä¸€è¡Œ</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">services.AddDbContext&lt;HostDbContext&gt;();</span><br></pre></td></tr></table></figure>

<h4 id="æµ‹è¯•æ•°æ®åº“ä¸Šä¸‹æ–‡"><a href="#æµ‹è¯•æ•°æ®åº“ä¸Šä¸‹æ–‡" class="headerlink" title="æµ‹è¯•æ•°æ®åº“ä¸Šä¸‹æ–‡"></a>æµ‹è¯•æ•°æ®åº“ä¸Šä¸‹æ–‡</h4><p>åœ¨<strong>PluginController.cs</strong>ä¸­è¿›è¡Œæ³¨å…¥å’Œæµ‹è¯•ã€‚</p>
<p>ï¼<strong>PluginController.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.Options;</span><br><span class="line"><span class="keyword">using</span> Share;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">ApiController</span>]</span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">"api/[controller]/[action]"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PluginController</span> : <span class="title">Controller</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">readonly</span> IAddService m_addService;</span><br><span class="line">        <span class="keyword">readonly</span> Plugin1Config m_config;</span><br><span class="line">        <span class="keyword">readonly</span> HostDbContext m_dbContext;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PluginController</span>(<span class="params">IAddService addService,</span></span></span><br><span class="line"><span class="function"><span class="params">            IOptions&lt;Plugin1Config&gt; options,</span></span></span><br><span class="line"><span class="function"><span class="params">            HostDbContext dbContext</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_addService = addService;</span><br><span class="line">            m_config = options.Value;</span><br><span class="line">            m_dbContext = dbContext;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">Ping</span>(<span class="params"></span>)</span> =&gt; <span class="string">"pong"</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">PingService</span>(<span class="params"><span class="keyword">string</span> a, <span class="keyword">string</span> b</span>)</span> =&gt; m_addService.Add(a, b);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ActionResult&lt;Plugin1Config&gt; <span class="title">PingConfig</span>(<span class="params"></span>)</span> =&gt; Json(m_config);</span><br><span class="line">        <span class="keyword">public</span> ActionResult&lt;List&lt;PluginData&gt;&gt; PingDb() =&gt; m_dbContext.Set&lt;PluginData&gt;().ToList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯èƒ½éœ€è¦æ·»åŠ çš„NuGetåŒ…</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Plugin1\  package  System.Linq</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¯´æ˜¯ç»ˆäºå®Œæˆæœ€åä¸€æ­¥äº†ã€‚</p>
<p>æœ€åä¸€æ­¥ï¼Ÿæˆ‘è¿˜æƒ³è¡¥å……ä¸€ç‚¹ã€‚</p>
<p><strong>PluginController</strong> <em>PingDb</em> æ–¹æ³•ä¸­ç”¨<code>m_dbContext.Set&lt;PluginData&gt;()</code>è¿™ç§æ–¹æ³•ä½¿ç”¨HostDbContextï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥å†™ä¸€ä¸ªHostDbContextçš„æ‹“å±•ç±»ã€‚å¤§æ¦‚åƒè¿™ä¸ªæ ·å­</p>
<p>ï¼<strong>HostDbContextExtensions.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> Share;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">HostDbContextExtensitions</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DbSet&lt;PluginData&gt; <span class="title">PluginDatas</span>(<span class="params"><span class="keyword">this</span> HostDbContext context</span>)</span> =&gt; context.Set&lt;PluginData&gt;();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>emmmï¼Œè¿™æ¬¡æ˜¯å®Œç»“äº†ã€‚</p>
<h4 id="åˆåˆå¯åŠ¨"><a href="#åˆåˆå¯åŠ¨" class="headerlink" title="åˆåˆå¯åŠ¨"></a>åˆåˆå¯åŠ¨</h4><p>æ„å»ºæ’ä»¶ï¼Œç„¶åå¯åŠ¨é¡¹ç›®ã€‚</p>
<p>åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥<a href="https://localhost:5001/api/plugin/pingdbã€‚" target="_blank" rel="noopener">https://localhost:5001/api/plugin/pingdbã€‚</a><br>æ€ä¹ˆæ ·ï¼Œæœ‰ç»“æœäº†å—ï¼ŸğŸ‘€</p>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>æˆ‘çš„ä¸ªäººè§‚ç‚¹ã€‚</p>
<p>æˆ‘è§‰å¾—å¯ä»¥ä»ä¸¤ä¸ªæ–¹å‘å»ä½¿ç”¨æ’ä»¶</p>
<ol>
<li>Hosté¡¹ç›®åŠŸèƒ½å®Œå¤‡ï¼Œæ’ä»¶åªæ˜¯æ‹“å±•åŠŸèƒ½ã€‚</li>
<li>Hosté¡¹ç›®å®Œå…¨ä¾èµ–æ’ä»¶å®ç°åŠŸèƒ½</li>
</ol>
<p>æ··åˆä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼ä¹Ÿå¥½ï¼Œå•å•åªç”¨å…¶ä¸­ä¸€ä¸ªæ–¹å¼ä¹Ÿå¥½ã€‚éƒ½æ²¡é—®é¢˜ï¼Œå…·ä½“å–å†³äºæ‰‹ä¸­çš„é”®ç›˜ï¼Œä¸æ˜¯ä¹ˆã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹ï¼Œ.NetCore ä¸­å·²ç»æ²¡æœ‰AppDomainçš„æ¦‚å¿µäº†ï¼Œæ’ä»¶æ— æ³•å®ç°çƒ­æ’æ‹”ã€‚</p>
<p>å®Œç»“ğŸ‘Œã€‚</p>
<h2 id="2020å¹´7æœˆ14æ—¥-æ›´"><a href="#2020å¹´7æœˆ14æ—¥-æ›´" class="headerlink" title="2020å¹´7æœˆ14æ—¥ æ›´"></a>2020å¹´7æœˆ14æ—¥ æ›´</h2><p>è¿™ä¸ªæ’ä»¶å®ç°æ–¹å¼å¯¹ .netcore 2.2 è¿˜æ˜¯å¯ä»¥çš„ï¼Œå¯¹ç°åœ¨æ¥è®²ï¼Œæœ‰äº›è¿‡æ—¶ã€‚</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">æ½‡æ«11</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://blog.iavjkaede.com/2020/05/18/NetCore%20Web%20Plugins/">http://blog.iavjkaede.com/2020/05/18/NetCore%20Web%20Plugins/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://blog.iavjkaede.com" target="_blank">å½’äº‘é˜</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C/">C#</a><a class="post-meta__tags" href="/tags/Plugins/">Plugins</a></div><div class="post_share"><div class="social-share" data-image="https://image.zsver.com/2020/05/23/ff71252584474.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/05/18/NetCore%20ImageSharp%20Watermark/"><img class="prev_cover" data-src="https://image.zsver.com/2020/05/23/43208491ef0e8.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">NetCore ä½¿ç”¨ ImageSharp ä¸ºå›¾ç‰‡æ·»åŠ æ°´å°</div></div></a></div><div class="next-post pull_right"><a href="/2020/05/18/Get%20MimeType%20via%20.NET/"><img class="next_cover" data-src="https://image.zsver.com/2020/05/23/d5c475845aca9.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">.Net ä¸­MimeType çš„è·å–</div></div></a></div></nav></article></main><footer id="footer" style="background-image: url(https://image.zsver.com/2020/05/23/67597c6252dd0.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By æ½‡æ«11</div><div class="framework-info"><span>Power by </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="é˜…è¯»æ¨¡å¼"></i><i class="fa fa-plus" id="font_plus" title="æ”¾å¤§å­—ä½“"></i><i class="fa fa-minus" id="font_minus" title="ç¼©å°å­—ä½“"></i><i class="darkmode far fa-moon" id="darkmode" title="å¤œé—´æ¨¡å¼"></i></div><div id="rightside-config-show"><div id="rightside_config" title="è®¾ç½®"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="ç›®å½•" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="å›åˆ°é¡¶éƒ¨" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script></body></html>