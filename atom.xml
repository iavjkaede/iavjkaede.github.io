<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å½’äº‘é˜</title>
  
  <subtitle>å¾¡é£åƒä¸‡é‡Œï¼Œç»ˆé¡»é›€å½’é˜</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.iavjkaede.com/"/>
  <updated>2020-06-21T13:19:43.246Z</updated>
  <id>http://blog.iavjkaede.com/</id>
  
  <author>
    <name>æ½‡æ«11</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åŸºäºnetcore ç¼–å†™æœ¬åœ°æœåŠ¡</title>
    <link href="http://blog.iavjkaede.com/2020/06/21/Create%20native%20service%20with%20dotnet/"/>
    <id>http://blog.iavjkaede.com/2020/06/21/Create%20native%20service%20with%20dotnet/</id>
    <published>2020-06-21T13:19:43.246Z</published>
    <updated>2020-06-21T13:19:43.246Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŸºäº-netcore-ç¼–å†™æœ¬åœ°æœåŠ¡"><a href="#åŸºäº-netcore-ç¼–å†™æœ¬åœ°æœåŠ¡" class="headerlink" title="åŸºäº.netcore ç¼–å†™æœ¬åœ°æœåŠ¡"></a>åŸºäº.netcore ç¼–å†™æœ¬åœ°æœåŠ¡</h1><p>æœåŠ¡ç¨‹åºï¼Œä¸€èˆ¬ä»£è¡¨ä¸€äº›éœ€è¦é•¿æœŸç¨³å®šè¿è¡Œï¼Œæ²¡æœ‰ç•Œé¢äº¤äº’çš„ç¨‹åºï¼Œå‘¨è€Œå¤å§‹ï¼Œç”Ÿç”Ÿä¸æ¯ã€‚é‚£ä¹ˆ,æ€ä¹ˆç”¨.netcore æ¥ç¼–ç»‡è¿™ä¹ˆä¸€ä¸ªç¨‹åºå‘¢ï¼Ÿ</p><h2 id="åˆ©å™¨"><a href="#åˆ©å™¨" class="headerlink" title="åˆ©å™¨"></a>åˆ©å™¨</h2><p>ä»¥ä¸‹æ˜¯åœ¨ä¸‹æ‰€ä½¿ç”¨çš„å·¥å…·</p><ul><li>VisualStduio 2019</li><li>.netcore 3.1</li></ul><h2 id="èµ·å§‹"><a href="#èµ·å§‹" class="headerlink" title="èµ·å§‹"></a>èµ·å§‹</h2><h3 id="é“ç”Ÿä¸€-ä½¿ç”¨Woker-Service-æ¨¡æ¿åˆ›å»ºæœåŠ¡"><a href="#é“ç”Ÿä¸€-ä½¿ç”¨Woker-Service-æ¨¡æ¿åˆ›å»ºæœåŠ¡" class="headerlink" title="é“ç”Ÿä¸€ | ä½¿ç”¨Woker Service æ¨¡æ¿åˆ›å»ºæœåŠ¡"></a>é“ç”Ÿä¸€ | ä½¿ç”¨Woker Service æ¨¡æ¿åˆ›å»ºæœåŠ¡</h3><p>å¯åŠ¨<code>VisualStudio 2019</code>ï¼Œé€‰æ‹©<code>åˆ›å»ºæ–°é¡¹ç›®</code>,åœ¨ä¸Šæ–¹çš„æœç´¢æ æœç´¢<code>service</code> ,å¦‚ä¸‹å›¾ã€‚</p><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://image.zsver.com/2020/06/01/45ed7d8f41ad2.png" alt="åˆ›å»ºWorker Service"></p><p>æˆ–è€…ä½¿ç”¨<code>dotnet new worker</code></p><p>è¿™é‡Œåœ¨ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>MyService</code>çš„é¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet new worker -n MyService</span><br></pre></td></tr></table></figure><p>çª¥æ¢ä¸€ç•ªé¡¹ç›®æ–‡ä»¶ï¼Œå¯è§é‡Œé¢æœ‰ä¸¤ä¸ªä¸»è¦çš„æ–‡ä»¶</p><ul><li><h4 id="Program-cs"><a href="#Program-cs" class="headerlink" title="Program.cs"></a>Program.cs</h4></li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  CreateHostBuilder(args).Build().Run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IHostBuilder <span class="title">CreateHostBuilder</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span> =&gt;</span><br><span class="line">          Host.CreateDefaultBuilder(args)</span><br><span class="line">              .ConfigureServices((hostContext, services) =&gt;</span><br><span class="line">              &#123;</span><br><span class="line">                  services.AddHostedService&lt;Worker&gt;();</span><br><span class="line">              &#125;);</span><br></pre></td></tr></table></figure><ul><li><h4 id="Worker-cs"><a href="#Worker-cs" class="headerlink" title="Worker.cs"></a>Worker.cs</h4></li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Worker</span> : <span class="title">BackgroundService</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">readonly</span> ILogger&lt;Worker&gt; _logger;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="title">Worker</span>(<span class="params">ILogger&lt;Worker&gt; logger</span>)</span></span><br><span class="line"><span class="function"></span>       &#123;</span><br><span class="line">           _logger = logger;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">async</span> Task <span class="title">ExecuteAsync</span>(<span class="params">CancellationToken stoppingToken</span>)</span></span><br><span class="line"><span class="function"></span>       &#123;</span><br><span class="line">           <span class="keyword">while</span> (!stoppingToken.IsCancellationRequested)</span><br><span class="line">           &#123;</span><br><span class="line">               _logger.LogInformation(<span class="string">"Worker running at: &#123;time&#125;"</span>, DateTimeOffset.Now);</span><br><span class="line">               <span class="keyword">await</span> Task.Delay(<span class="number">1000</span>, stoppingToken);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½æ˜¯ç›¸å½“ç®€æ´æ˜äº†çš„ã€‚<br><code>Program.cs</code> åˆ›å»º<code>Host</code>å¹¶å¯¹Workerè¿›è¡Œæ‰˜ç®¡ã€‚<br>é‚£ä¹ˆWorkeræ˜¯ä»€ä¹ˆ?<br> &emsp; ä»<code>Worker.cs</code>ä¸­å¯è§Workeråªæ˜¯ç»§æ‰¿è‡ª<code>BackgroundService</code>çš„å­ç±»ã€‚<br><code>BackgroundService</code>åˆæ˜¯ä½•æ–¹ç¥åœ£å‘¢ï¼Ÿ<br>  &emsp;çª¥ä¸€çœ¼<code>MyService</code>çš„é¡¹ç›®ä¾èµ–ï¼Œä¾èµ–åŒ…é‡Œæœ‰<code>Microsoft.Extensions.Hosting</code>è¿™ä¸€é¡¹ï¼Œ<code>BackgroundService</code>æ­£æ˜¯æ¥è‡ªäºæ­¤ã€‚<br>è¿™ä¹ˆä¸€çœ‹ï¼Œä¸è¿‡å¦‚æ­¤ï¼Œå¦‚æœé˜ä¸‹ä¸ä½¿ç”¨VS æ¨¡æ¿æ¥åˆ›å»ºè‡ªå·±çš„æœåŠ¡ï¼Œæƒ³å¿…ä¹Ÿæ˜¯æ˜“å¦‚åæŒã€‚</p><h3 id="ä¸€ç”ŸäºŒ-ç¼–å†™å±äºè‡ªå·±çš„Worker"><a href="#ä¸€ç”ŸäºŒ-ç¼–å†™å±äºè‡ªå·±çš„Worker" class="headerlink" title="ä¸€ç”ŸäºŒ | ç¼–å†™å±äºè‡ªå·±çš„Worker"></a>ä¸€ç”ŸäºŒ | ç¼–å†™å±äºè‡ªå·±çš„Worker</h3><p>æ–°å»º <code>MyWorker.cs</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">MyWorker</span> : <span class="title">BackgroundService</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="keyword">string</span>[] _lines =</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="string">"æ²‰èˆŸä¾§ç•”åƒå¸†è¿‡ï¼Œ"</span>,</span><br><span class="line">           <span class="string">"ç—…æ ‘å‰å¤´ä¸‡æœ¨æ˜¥ã€‚"</span>,</span><br><span class="line">           <span class="string">"-------------"</span>,</span><br><span class="line">           <span class="string">"é•¿é£ç ´æµªä¼šæœ‰æ—¶ï¼Œ"</span>,</span><br><span class="line">           <span class="string">"ç›´æŒ‚äº‘å¸†æµæ²§æµ·ã€‚"</span>,</span><br><span class="line">           <span class="string">"-------------"</span>,</span><br><span class="line">           <span class="string">"è°æ— æš´é£åŠ²é›¨æ—¶ï¼Œ"</span>,</span><br><span class="line">           <span class="string">"å®ˆå¾—äº‘å¼€è§æœˆæ˜ã€‚"</span>,</span><br><span class="line">           <span class="string">"-------------"</span></span><br><span class="line">       &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">async</span> <span class="keyword">override</span> Task <span class="title">ExecuteAsync</span>(<span class="params">CancellationToken stoppingToken</span>)</span></span><br><span class="line"><span class="function"></span>       &#123;</span><br><span class="line">           <span class="keyword">while</span>(!stoppingToken.IsCancellationRequested)</span><br><span class="line">           &#123;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">foreach</span> (<span class="keyword">var</span> line <span class="keyword">in</span> _lines)</span><br><span class="line">               &#123;</span><br><span class="line">                   <span class="keyword">await</span> Task.Delay(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">                   <span class="keyword">foreach</span> (<span class="keyword">var</span> ch <span class="keyword">in</span> line)</span><br><span class="line">                   &#123;</span><br><span class="line">                       Console.Write(ch);</span><br><span class="line">                       <span class="keyword">await</span> Task.Delay(<span class="number">100</span>);</span><br><span class="line">                   &#125;</span><br><span class="line"></span><br><span class="line">                   Console.Write(<span class="string">"\r"</span>);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦å°†Worker æ³¨å…¥ã€‚<br><code>services.AddHostedService&lt;MyWorker&gt;();</code><br>æ³¨é‡Šæ‰ <code>services.AddHostedService&lt;Worker&gt;();</code>,è€Œåªå…³æ³¨<code>MyWorker</code></p><p>è¿è¡Œä¹‹åï¼Œå°±å¯ä»¥çœ‹åˆ°å†…å®¹è¾“å‡ºäº†ã€‚è¿™ç‚¹å¾ˆé‡è¦ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰æ§åˆ¶å°çª—å£ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ— ç•Œé¢çš„æœåŠ¡ï¼Ÿ<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://image.zsver.com/2020/06/01/1a5bde9b72a3e.gif" alt="è¿è¡Œæƒ…å†µ"><br>å—¯ï¼Œç°åœ¨å®ƒè¿˜æ˜¯ä¸€ä¸ªæ§åˆ¶å°ç¨‹åºã€‚<br>é‚£ä¹ˆï¼Œå¦‚å’Œéƒ¨ç½²æˆæœåŠ¡å‘¢ï¼Ÿ  </p><h3 id="ä¸‰ç”Ÿä¸‡ç‰©-éƒ¨ç½²Windows-æœåŠ¡"><a href="#ä¸‰ç”Ÿä¸‡ç‰©-éƒ¨ç½²Windows-æœåŠ¡" class="headerlink" title="ä¸‰ç”Ÿä¸‡ç‰© | éƒ¨ç½²Windows æœåŠ¡"></a>ä¸‰ç”Ÿä¸‡ç‰© | éƒ¨ç½²Windows æœåŠ¡</h3><p>é¦–å…ˆï¼Œè¦åšä¸€äº›æ”¹åŠ¨  </p><ol><li><p>ä¸º<code>MyService</code>é¡¹ç›®æ·»åŠ nugetåŒ… <code>Microsoft.Extensions.Hosting.WindowsServices</code></p></li><li><p>ä¿®æ”¹ <code>Program.cs</code> ä¸­çš„ <code>CreateHostBuilder</code> å‡½æ•°ï¼Œåœ¨æœ€ååŠ ä¸Š <code>UseWindowsService()</code><br>å¦‚ä¸‹  </p></li></ol><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> IHostBuilder <span class="title">CreateHostBuilder</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>          =&gt; Host.CreateDefaultBuilder(args).ConfigureServices(services =&gt;</span><br><span class="line">          &#123;</span><br><span class="line">              services.AddHostedService&lt;MyWorker&gt;();</span><br><span class="line">          &#125;).UseWindowsService();</span><br></pre></td></tr></table></figure><p>æ¥ç€<br>è¿™é‡Œéœ€è¦ä½¿ç”¨å¦ä¸€æŠŠæ­¦å™¨ <code>sc</code><br>æ‰“å¼€cmdçª—å£ï¼ˆä½¿ç”¨Powershell ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ä½ç‰ˆæœ¬çš„Powershell å¯èƒ½ä¼šå‡ºé”™ï¼‰</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sc create MyService binpath=E:\full\path\to\yourbinaryfile.exe</span><br><span class="line"><span class="comment"># binpath ä¸€å®šæ˜¯ç»å¯¹è·¯å¾„ï¼Œå¦åˆ™è¿è¡ŒæœåŠ¡ä¼šæç¤ºç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šæ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦å¤–</span></span><br><span class="line">sc start MyService</span><br><span class="line">sc stop MyService</span><br><span class="line">sc delete MyService</span><br></pre></td></tr></table></figure><p>ç¨‹åºåœ¨æ§åˆ¶å°è¾“å‡ºï¼Œæ‰€ä»¥å®‰è£…æˆæœåŠ¡å¹¶ä¸èƒ½çœ‹åˆ°æ•ˆæœã€‚è°ç®¡å‘¢ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œä½¿ç”¨.netcoreåˆ›å»ºæœåŠ¡ç¨‹åºå¾ˆç®€å•ï¼Œè¿™ç§æ–¹å¼ç”¨åœ¨.netframeworkä¸Šåˆå½“å¦‚ä½•å‘¢ï¼Ÿé˜ä¸‹å¯è‡ªè¡Œå°è¯•ï¼Œæ­¤å¤„ä¸å†å¤šè¨€ã€‚  </p><p>&emsp;<em>æ›´å¤šåˆ›å»ºæœåŠ¡çš„æ–¹å¼ï¼Œå¯ä»¥ç‚¹å‡»ä¸‹é¢çš„å¼•ç”¨é“¾æ¥</em></p><h2 id="ç»ˆ"><a href="#ç»ˆ" class="headerlink" title="ç»ˆ"></a>ç»ˆ</h2><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="https://dotnetcoretutorials.com/2019/12/07/creating-windows-services-in-net-core-part-3-the-net-core-worker-way/" target="_blank" rel="noopener">Creating Windows Services In .NET Core â€“ Part 3 â€“ The â€œ.NET Core Workerâ€ Way</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;åŸºäº-netcore-ç¼–å†™æœ¬åœ°æœåŠ¡&quot;&gt;&lt;a href=&quot;#åŸºäº-netcore-ç¼–å†™æœ¬åœ°æœåŠ¡&quot; class=&quot;headerlink&quot; title=&quot;åŸºäº.netcore ç¼–å†™æœ¬åœ°æœåŠ¡&quot;&gt;&lt;/a&gt;åŸºäº.netcore ç¼–å†™æœ¬åœ°æœåŠ¡&lt;/h1&gt;&lt;p&gt;æœåŠ¡ç¨‹åºï¼Œä¸€èˆ¬ä»£è¡¨ä¸€
      
    
    </summary>
    
    
      <category term=".NET" scheme="http://blog.iavjkaede.com/categories/NET/"/>
    
    
      <category term="C#" scheme="http://blog.iavjkaede.com/tags/C/"/>
    
      <category term="Service" scheme="http://blog.iavjkaede.com/tags/Service/"/>
    
  </entry>
  
  <entry>
    <title>Linuxå­ç³»ç»Ÿï¼ˆWSLï¼‰Debianå®‰è£…aria2å¹¶é…ç½®AriaNg</title>
    <link href="http://blog.iavjkaede.com/2020/05/18/Install%20Aria2%20for%20Debian%20WSL/"/>
    <id>http://blog.iavjkaede.com/2020/05/18/Install%20Aria2%20for%20Debian%20WSL/</id>
    <published>2020-05-18T15:22:37.125Z</published>
    <updated>2020-05-23T08:51:57.344Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒç®€ä»‹"><a href="#ç¯å¢ƒç®€ä»‹" class="headerlink" title="ç¯å¢ƒç®€ä»‹"></a>ç¯å¢ƒç®€ä»‹</h2><h3 id="ç³»ç»Ÿç¯å¢ƒ"><a href="#ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒ"></a>ç³»ç»Ÿç¯å¢ƒ</h3><p>Window 10 LTSC 2019  <strong>å¼€å¯WSL</strong></p><p>WSL ä½¿ç”¨ <strong>Debian å‘è¡Œç‰ˆ</strong></p><h3 id="Shell-ç¯å¢ƒ"><a href="#Shell-ç¯å¢ƒ" class="headerlink" title="Shell ç¯å¢ƒ"></a>Shell ç¯å¢ƒ</h3><p>ZSH</p><h3 id="å°†å®‰è£…çš„è½¯ä»¶ç‰ˆæœ¬"><a href="#å°†å®‰è£…çš„è½¯ä»¶ç‰ˆæœ¬" class="headerlink" title="å°†å®‰è£…çš„è½¯ä»¶ç‰ˆæœ¬"></a>å°†å®‰è£…çš„è½¯ä»¶ç‰ˆæœ¬</h3><p>aria2    ç‰ˆæœ¬ <strong>1.30.0</strong></p><p>AriaNg ç‰ˆæœ¬ <strong>1.1.1</strong></p><h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><h3 id="å®‰è£…aria2"><a href="#å®‰è£…aria2" class="headerlink" title="å®‰è£…aria2"></a>å®‰è£…aria2</h3><p>é¦–å…ˆè¿›è¡Œ<a href="https://github.com/aria2/aria2" target="_blank" rel="noopener">aria2</a> çš„å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install aria2</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆè¾“å…¥ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®‰è£…æ˜¯å¦æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aria2c --version</span><br></pre></td></tr></table></figure><p>æˆåŠŸè¾“å‡ºç‰ˆæœ¬ä¿¡æ¯åï¼Œå®‰è£…å°±å®Œæˆäº†</p><h3 id="é…ç½®aria2"><a href="#é…ç½®aria2" class="headerlink" title="é…ç½®aria2"></a>é…ç½®aria2</h3><p><span id="aria2_conf">é…ç½®aria2</span></p><p>å®‰è£…æ˜¯å¾ˆç®€å•ï¼Œé…ç½®aria2 å´æ˜¯æœ‰äº›æ£˜æ‰‹çš„ï¼Œå½“ç„¶ä¸è¿›è¡Œé…ç½®ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œè¿™é‡Œä¸è¿‡å¤šä»‹ç»ï¼Œè®²ä¸€ä¸‹æˆ‘è‡ªå·±çš„é…ç½®ã€‚</p><p>éœ€è¦åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ç”¨æ¥ä¿å­˜aria2 çš„é…ç½®ã€ä¼šè¯å’Œæ—¥å¿—ã€‚</p><p>æˆ‘è¿™é‡Œåœ¨ç”¨æˆ·ç›®å½•ä¸‹å»ºç«‹æ–‡ä»¶å¤¹ï¼Œå…¶å®å¯ä»¥å°†é…ç½®ç›®å½•æ”¾åœ¨Windowsç›®å½•ä¸‹ï¼Œè¿™æ ·é‡æ–°å®‰è£…</p><p>WSLçš„æ—¶å€™å°±æ— éœ€é‡æ–°åˆ›å»ºç¼–å†™é…ç½®æ–‡ä»¶äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> </span><br><span class="line">mkdir .aria2</span><br><span class="line"><span class="built_in">cd</span> .aria2</span><br><span class="line">touch aria2.conf</span><br><span class="line">touch aria2.session</span><br><span class="line">touch aria2.log</span><br></pre></td></tr></table></figure><p>å®Œæˆåè¿›è¡Œaria2 çš„é…ç½®ï¼Œè¿™é‡Œåªè®°å½•æˆ‘è‡ªå·±çš„é…ç½®ï¼Œè¯¦ç»†é…ç½®è‡ªè¡Œæœç´¢æŸ¥é˜…ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Log Options</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log-level</span>=warn</span><br><span class="line"><span class="attr">log</span>=/home/<span class="variable">$LOGNAME</span>/.aria2/aria2.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># Running on background</span></span><br><span class="line"><span class="attr">daemon</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Download path</span></span><br><span class="line"><span class="comment"># ä¸‹è½½åœ°å€ï¼Œå¯ä»¥æ”¾åœ¨Windowsç³»ç»Ÿçš„ç›®å½•ä¸‹ï¼Œæ¯”å¦‚ä»¥ä¸‹æ˜¯Eç›˜çš„download</span></span><br><span class="line"><span class="attr">dir</span>=/mnt/e/Download</span><br><span class="line"></span><br><span class="line"><span class="comment"># Session Options</span></span><br><span class="line"><span class="attr">input-file</span>=/home/<span class="variable">$LOGNAME</span>/.aria2/aria2.session</span><br><span class="line"><span class="attr">save-session</span>=/home/<span class="variable">$LOGNAME</span>/.aria2/aria2.session</span><br><span class="line"><span class="attr">save-session-interval</span>=<span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="attr">continue</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disk cache</span></span><br><span class="line"><span class="attr">disk-cache</span>=<span class="number">32</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># RPC Options</span></span><br><span class="line"><span class="comment"># å› ä¸ºåªåœ¨æœ¬åœ°ä½¿ç”¨ï¼Œä¸ç”¨rpcå®‰å…¨è®¾ç½®ä¹Ÿå¯ä»¥</span></span><br><span class="line"><span class="attr">enable-rpc</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">rpc-allow-origin-all</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">rpc-listen-port</span>=<span class="number">6800</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¶ä»–æ›´è¯¦ç»†çš„é…ç½®è‡ªè¡ŒæŸ¥é˜…å§ï¼Œæˆ–è€…å¾…ä¼šæˆ‘ä»¬é…ç½®AriaNgå°±å¯ä»¥å…·ä½“çœ‹å¯ä»¥é…ç½®å“ªäº›å†…å®¹äº†</span></span><br></pre></td></tr></table></figure><p><strong>$LOGNAME</strong> æ›¿æ¢æˆä½ ç”¨æˆ·å</p><p>ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨ aria2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aria2c --conf-path /home/<span class="variable">$LOGNAME</span>/.aria2/aria2.conf</span><br></pre></td></tr></table></figure><p><em>é…ç½®è¿™ä¸ªåœ°æ–¹å¯èƒ½ä¼šæœ‰å‘ï¼Œå¦‚æœé…ç½®æ–‡ä»¶å†™é”™äº†ï¼Œè¿™ä¸ªå‘½ä»¤å¯èƒ½æ²¡æœ‰ä»»ä½•æŠ¥é”™å°±é€€å‡ºäº†ï¼Œæˆ–è€…rpcæ²¡æœ‰æˆåŠŸå¼€å¯ã€‚æ‰§è¡Œå®Œè¿™æ¡å‘½ä»¤åï¼Œåœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥<a href="http://localhost:6800" target="_blank" rel="noopener">http://localhost:6800</a></em></p><p><em>å¦‚æœå‡ºç°404è€Œä¸æ˜¯æœªå“åº”ï¼Œè¯´æ˜rpcæ˜¯æ­£å¸¸å¼€å¯äº†çš„ï¼ˆåœ¨æ²¡æœ‰å…¶ä»–è¿›ç¨‹å ç”¨6800ç«¯å£çš„æƒ…å†µä¸‹ï¼‰ï¼Œè¿™é‡ŒæåŠçš„ç«¯å£å·å¯¹åº”é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£å·<code>rpc-listen-port</code></em></p><p>å¦å¤–ï¼Œæˆ‘ä¸çŸ¥é“aria2 æœ‰æ²¡æœ‰æ£€æŸ¥é…ç½®æ–‡ä»¶çš„å‘½ä»¤ï¼Œæˆ‘æ˜¯ç”¨ç¬¨æ–¹æ³•æ’é™¤é”™è¯¯ï¼ŒæŠŠé…ç½®æ–‡ä»¶çš„<code>daemon=true</code> å»æ‰ç„¶åä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨aria2cï¼Œä¼šæç¤ºé”™è¯¯ä¿¡æ¯çš„ã€‚å¦‚æœæ²¡æœ‰æç¤ºï¼Œå¯ä»¥å…ˆæŠŠä¸é‡è¦çš„é…ç½®æ³¨é‡Šæ‰å†æ¬¡å¯åŠ¨ï¼Œrpcæ˜¯ä¸€å®šè¦å¼€å¯çš„ï¼Œå…¶ä»–é…ç½®å¯¹æˆ‘æ¥è¯´æ¯”è¾ƒæ¬¡è¦ã€‚</p><h3 id="é…ç½®AriaNg"><a href="#é…ç½®AriaNg" class="headerlink" title="é…ç½®AriaNg"></a>é…ç½®AriaNg</h3><p>é…ç½®å¥½aria2 å¯æ˜¯å¦‚æœæ¯æ¬¡ä¸‹è½½æ–‡ä»¶éƒ½å»æ‰§è¡Œå‘½ä»¤ï¼Œè™½ç„¶å¾ˆhackerï¼Œä½†å¹¶ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚æˆ‘é€‰æ‹©ä½¿ç”¨<a href="https://github.com/mayswind/AriaNg" target="_blank" rel="noopener">AriaNg</a>æ¥æ“ä½œaria2 ï¼ŒAriaNgæ˜¯ä¸€ä¸ªåŸºäºWebçš„arai2 å‰ç«¯ã€‚å¯ä»¥åœ¨<strong>github</strong> çš„<strong>Release</strong>é¡µé¢ä¸­ä¸‹è½½<strong>AllInOne</strong>ç‰ˆæœ¬ã€‚</p><p><a href="https://github.com/mayswind/AriaNg" target="_blank" rel="noopener">AriaNg Github</a></p><p>AllInOne ç‰ˆæœ¬é‡Œé¢åŒ…å«ä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œè¿™å°±æ˜¯æˆ‘è¦çš„ï¼Œæˆ‘ä»¬ç›´æ¥åŒå‡»æ‰“å¼€åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚</p><p>å½“çœ‹åˆ°å·¦ä¾§èœå•æ æœ€åä¸€æ¡æœ‰å·²è¿æ¥çš„ç»¿è‰²æ ‡å¿—ï¼Œè¡¨ç¤ºé“¾æ¥æˆåŠŸã€‚å¦‚æœä¸€è‡´æ˜¾ç¤ºæœªè¿æ¥ï¼Œé‚£å¯èƒ½æ˜¯é…ç½®å‡ºäº†é—®é¢˜ï¼Œåº”è¯¥ä»”ç»†çœ‹çœ‹æœ‰æ²¡æœ‰æ­£ç¡®<strong>é…ç½®aria2</strong>ã€‚</p><p>åˆ°è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»èƒ½æ„‰å¿«çš„ä½¿ç”¨aria2äº†ï¼Œä½†æ˜¯ï¼Œæˆ‘è¿˜æƒ³å®Œæˆä¸¤ä»¶äº‹æƒ…ã€‚</p><ul><li><p>æˆ‘å¸Œæœ›æŠŠAriaNgéƒ¨ç½²æˆWebæœåŠ¡ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨æœ¬åœ°å»æ‰“å¼€htmlæ–‡ä»¶ï¼ˆè¿™å¾ˆä¸é…·ï¼‰</p></li><li><p>æˆ‘å¸Œæœ›æ¯æ¬¡å¼€æœºçš„æ—¶å€™è‡ªåŠ¨å¯åŠ¨aria2c</p></li></ul><h4 id="é…ç½®é™æ€æ–‡ä»¶æœåŠ¡"><a href="#é…ç½®é™æ€æ–‡ä»¶æœåŠ¡" class="headerlink" title="é…ç½®é™æ€æ–‡ä»¶æœåŠ¡"></a>é…ç½®é™æ€æ–‡ä»¶æœåŠ¡</h4><p>è¿™é‡Œæˆ‘å°†ä½¿ç”¨Nodejsæ¥å®ç°ã€‚</p><p>æœ‰å…³å¦‚ä½•åœ¨WSLä¸­å®‰è£…Nodejsï¼Œè¯·å‚è€ƒ <a href="/2020/05/18/Install%20nodejs%20for%20Debian%20WSL/" title="Linuxå­ç³»ç»Ÿï¼ˆWSLï¼‰Debianå®‰è£…Nodejs">Linuxå­ç³»ç»Ÿï¼ˆWSLï¼‰Debianå®‰è£…Nodejs</a></p><p>å®‰è£…å¥½Nodejs åï¼Œç¡®å®šä¸€ä¸‹npm å‘½ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm --version</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬<strong>å»ºç«‹ä¸€ä¸ªç›®å½•å­˜æ”¾é™æ€é¡µï¼Œå°†AriaNgï¼ˆIndex.html)æ–‡ä»¶æ”¾åœ¨è¯¥ç›®å½•ä¸‹ï¼Œå¹¶cd åˆ°è¯¥ç›®å½•</strong></p><p>å»ºç«‹ä¸€ä¸ªç”¨äºæ”¯æŒwebæœåŠ¡çš„jsæ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch server.js</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘è¯¥æ–‡ä»¶è¾“å…¥ä»¥ä¸‹å†…å®¹å¹¶ä¿å­˜ã€‚</p><p><strong>server.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(express.static(<span class="string">"./"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç«¯å£å·è‡ªè¡Œé…ç½®</span></span><br><span class="line">app.listen(<span class="number">8081</span>,()=&gt;&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Server start !'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>emmmmï¼Œç°åœ¨è¿˜ä¸èƒ½è¿è¡Œï¼Œéœ€è¦è£…ä¸€ä¸‹<strong>express</strong> ä¾èµ–åŒ…âœ”</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express --save</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br></pre></td></tr></table></figure><p><em>è¿™å‡ ä¸ªå‘½ä»¤éƒ½æ˜¯åœ¨æœ€åˆå»ºç«‹çš„ç›®å½•ä¸‹å®Œæˆçš„</em></p><p>å½“ä½ çœ‹åˆ°ç»ˆç«¯è¾“å‡º<code>Server start !</code>ï¼Œå»æµè§ˆå™¨è¾“å‡º<a href="http://localhost:8081ï¼Œçœ‹æ˜¯ä¸æ˜¯æ‰“å¼€äº†AriaNgğŸ‘Œã€‚">http://localhost:8081ï¼Œçœ‹æ˜¯ä¸æ˜¯æ‰“å¼€äº†AriaNgğŸ‘Œã€‚</a></p><p>ç°åœ¨æ‰“å¼€äº†é™æ€é¡µæœåŠ¡ï¼Œä¸è¿‡å®ƒè¿˜æ˜¯åœ¨ç»ˆç«¯ä¸‹æ‰§è¡Œçš„ï¼Œå…³æ‰ç»ˆç«¯åï¼Œé™æ€é¡µæœåŠ¡ä¹Ÿå°±å…³äº†ã€‚</p><h4 id="ç”¨Supervisorå®ˆæŠ¤è¿›ç¨‹"><a href="#ç”¨Supervisorå®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="ç”¨Supervisorå®ˆæŠ¤è¿›ç¨‹"></a>ç”¨Supervisorå®ˆæŠ¤è¿›ç¨‹</h4><p>é¦–å…ˆå®‰è£…Supervisor</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install supervisor</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘ä½¿ç”¨çš„debianä¸­ï¼Œå®‰è£…åä¼šåœ¨ <code>/etc/supervisor</code> ç”Ÿæˆä¸€ä¸ª<strong>supervisord.conf</strong>æ–‡ä»¶å’Œä¸€ä¸ª<strong>conf.d</strong>ç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨conf.dç›®å½•ä¸­å»ºç«‹é…ç½®ã€‚supervisord.confæ–‡ä»¶ä¸­å·²ç»åŒ…å«äº†å®ƒã€‚<em>ä¸èƒ½ä¿è¯ä½¿ç”¨çš„ç¯å¢ƒéƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œåªæ˜¯æˆ‘è‡ªå·±çš„ç¯å¢ƒã€‚</em></p><h5 id="å»ºç«‹ariaNg-çš„supervisoré…ç½®æ–‡ä»¶"><a href="#å»ºç«‹ariaNg-çš„supervisoré…ç½®æ–‡ä»¶" class="headerlink" title="å»ºç«‹ariaNg çš„supervisoré…ç½®æ–‡ä»¶"></a>å»ºç«‹ariaNg çš„supervisoré…ç½®æ–‡ä»¶</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/supervisor/conf.d</span><br><span class="line">sudo vi ariaNg.conf</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><p><strong>ariaNg.conf</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[program:ariaNg]</span></span><br><span class="line"><span class="attr">command</span>=node server.js</span><br><span class="line"><span class="attr">directory</span>=/home/ariaNg<span class="comment">#é…ç½®é™æ€é¡µçš„ç›®å½•</span></span><br><span class="line"><span class="attr">user</span>=root</span><br><span class="line"><span class="attr">autorestart</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">stderr_logfile</span>=/var/log/ariaNg/err.log</span><br><span class="line"><span class="attr">stdout_logfile</span>=/var/log/ariaNg/out.log</span><br></pre></td></tr></table></figure><h5 id="å¯åŠ¨supervisor"><a href="#å¯åŠ¨supervisor" class="headerlink" title="å¯åŠ¨supervisor"></a>å¯åŠ¨supervisor</h5><p>åœ¨å¯åŠ¨supervisorå‰ï¼Œå¯èƒ½éœ€è¦å»ºç«‹ariaNgçš„æ—¥å¿—ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /var/<span class="built_in">log</span>/ariaNg</span><br></pre></td></tr></table></figure><p>å¯åŠ¨supervisoræœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service supervisor start</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ä¸‹è¿è¡ŒçŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo supervisorctl status</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°<code>aria2Ng                          RUNNING</code> ç„¶åå»æµè§ˆå™¨è®¿é—®ä¸€ä¸‹ç¡®å®šæ˜¯å¦æˆåŠŸã€‚</p><p>ä½¿ç”¨supervisorctl çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæŠ¥<strong>unix:///var/run/supervisor.sock no such file</strong>è¿™ä¸ªé”™è¯¯ã€‚ä¸è¦æ…Œã€‚</p><p>å¯ä»¥å…ˆçœ‹ä¸€ä¸‹ariaNg çš„logæ–‡ä»¶ï¼Œçœ‹çœ‹æ˜¯å“ªä¸ªåœ°æ–¹å‡ºäº†é—®é¢˜ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/<span class="built_in">log</span>/ariaNg/err.log</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯é…ç½®çš„é—®é¢˜ï¼Œå°±å»ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚</p><p>ç„¶ååœæ­¢supervisor æœåŠ¡ï¼Œå†æ¬¡å¯åŠ¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo service supervisor stop</span><br><span class="line">sudo service supervisor start</span><br><span class="line"></span><br><span class="line">sudo supervisorctl status</span><br></pre></td></tr></table></figure><p>æˆ‘å½“æ—¶ç›´æ¥é‡è£…äº†supervisorï¼Œå› ä¸ºåˆšå¼€å§‹æ²¡å¸è½½å¹²å‡€ï¼Œè¿˜é‡è£…äº†å¥½å‡ éï¼ŒğŸ˜‚ã€‚</p><p>å½“æ‰€æœ‰ä¸€åˆ‡éƒ½é…ç½®å¥½åï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æµè§ˆå™¨ä¸­å°±èƒ½ä½¿ç”¨aria2 äº†ï¼Œä¸è¿‡ï¼Œæˆ‘è¿˜å¸Œæœ›å®ƒä»¬èƒ½åœ¨å¼€æœºæ—¶è‡ªåŠ¨å¯åŠ¨ã€‚</p><h3 id="å¼€æœºè‡ªåŠ¨å¯åŠ¨aria2"><a href="#å¼€æœºè‡ªåŠ¨å¯åŠ¨aria2" class="headerlink" title="å¼€æœºè‡ªåŠ¨å¯åŠ¨aria2"></a>å¼€æœºè‡ªåŠ¨å¯åŠ¨aria2</h3><p>æˆ‘å¯ä¸æƒ³æ¯æ¬¡å¼€æœºéƒ½è¦æ‰“å¼€å‘½ä»¤è¡Œç„¶åè¾“å…¥å‘½ä»¤å»å¯åŠ¨aria2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aria2c --conf-path /home/<span class="variable">$LOGNAME</span>/.aria2/aria2.conf</span><br><span class="line">sudo service supervisor</span><br></pre></td></tr></table></figure><p>åºŸè¯å°‘è¯´ï¼Œæœ‰å…³å¦‚ä½•è®¾ç½®åœ¨WSLä¸­å¼€æœºè‡ªåŠ¨å¯åŠ¨æœåŠ¡çš„æ–¹æ³•å…ˆå»è¿™çœ‹ä¸€ä¸‹å§ã€‚</p><a href="/2019/03/02/WSL%20Service%20Autostart/" title="Linuxå­ç³»ç»Ÿ(WSL)ä¸­çš„æœåŠ¡å¼€æœºå¯åŠ¨">Linuxå­ç³»ç»Ÿ(WSL)ä¸­çš„æœåŠ¡å¼€æœºå¯åŠ¨</a><p>é…ç½®å¥½å¼€æœºè‡ªå¯è„šæœ¬åï¼Œåªéœ€è¦åœ¨init.wsl ä¸­åŠ å…¥ä»¥ä¸‹å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/supervisor <span class="variable">$1</span></span><br><span class="line">aria2c --conf-path=/home/xiaosen/.aria2/aria2.conf</span><br></pre></td></tr></table></figure><p>æå®šğŸ‘ğŸ‘ğŸ‘</p><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>è¿™å¤§æ¦‚å°±æ˜¯æˆ‘å®‰è£…ä½¿ç”¨aria2 çš„æ•´ä¸ªè¿‡ç¨‹äº†ã€‚</p><p><em>æ°´å¹³æœ‰é™ï¼Œå¦‚æœæŸäº›åœ°æ–¹ä¸æ­£ç¡®ï¼Œæ³è¯·æ–§æ­£ï¼Œæ„Ÿè°¢ï¼</em></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://www.jianshu.com/p/6adf79d29add" target="_blank" rel="noopener">Aria2 é…ç½®è¯¦è§£</a></p><p><a href="https://blog.csdn.net/wenwushq/article/details/79827718" target="_blank" rel="noopener">ç”¨nodejsæ­å»ºé™æ€ç½‘é¡µæœåŠ¡å™¨å±…ç„¶è¿™ä¹ˆç®€å•</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç¯å¢ƒç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒç®€ä»‹&quot;&gt;&lt;/a&gt;ç¯å¢ƒç®€ä»‹&lt;/h2&gt;&lt;h3 id=&quot;ç³»ç»Ÿç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#ç³»ç»Ÿç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;ç³»ç»Ÿç¯å¢ƒ&quot;&gt;&lt;/a
      
    
    </summary>
    
    
      <category term="Deploy" scheme="http://blog.iavjkaede.com/categories/Deploy/"/>
    
    
      <category term="WSL" scheme="http://blog.iavjkaede.com/tags/WSL/"/>
    
      <category term="Aria2" scheme="http://blog.iavjkaede.com/tags/Aria2/"/>
    
      <category term="Debian" scheme="http://blog.iavjkaede.com/tags/Debian/"/>
    
  </entry>
  
  <entry>
    <title>Linuxå­ç³»ç»Ÿï¼ˆWSLï¼‰Debianå®‰è£…Nodejs</title>
    <link href="http://blog.iavjkaede.com/2020/05/18/Install%20nodejs%20for%20Debian%20WSL/"/>
    <id>http://blog.iavjkaede.com/2020/05/18/Install%20nodejs%20for%20Debian%20WSL/</id>
    <published>2020-05-18T15:22:37.125Z</published>
    <updated>2020-05-23T08:52:11.986Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒç®€ä»‹"><a href="#ç¯å¢ƒç®€ä»‹" class="headerlink" title="ç¯å¢ƒç®€ä»‹"></a>ç¯å¢ƒç®€ä»‹</h2><h3 id="ç³»ç»Ÿç¯å¢ƒ"><a href="#ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒ"></a>ç³»ç»Ÿç¯å¢ƒ</h3><p>Windows 10 LTSC 2019 </p><p><em>å·²å®‰è£… Nodejs</em></p><p><em>å·²å¼€å¯ WSL</em></p><p>WSL ï¼šDebian å‘è¡Œç‰ˆ</p><h3 id="Shell-ç¯å¢ƒ"><a href="#Shell-ç¯å¢ƒ" class="headerlink" title="Shell ç¯å¢ƒ"></a>Shell ç¯å¢ƒ</h3><p>ZSH</p><h2 id="å®‰è£…Nodejs"><a href="#å®‰è£…Nodejs" class="headerlink" title="å®‰è£…Nodejs"></a>å®‰è£…Nodejs</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash -</span><br><span class="line">sudo apt install -y nodejs</span><br></pre></td></tr></table></figure><p><strong>ç›¸åº”çš„ç‰ˆæœ¬å¯åœ¨ setup_<em>10.x</em></strong> å¤„æ›¿æ¢ï¼Œä¾‹å¦‚ 8.x/9.x</p><h2 id="æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ"><a href="#æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ" class="headerlink" title="æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ"></a>æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure><h2 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h2><p>å› ä¸ºæ˜¯åœ¨WSLä¸­å®‰è£…ï¼Œå¦‚æœåœ¨Win10 ä¸­ä¹Ÿå®‰è£…äº†Nodejsï¼Œåœ¨WSLä¸­ä½¿ç”¨npmå‘½ä»¤ä¼šå‡ºç°æ‰¾ä¸åˆ°npmçš„æƒ…å†µï¼Œä¸‹é¢è¯´ä¸‹æ€ä¹ˆè§£å†³ã€‚</p><h3 id="å…ˆçœ‹ä¸€ä¸‹npmåœ¨å“ª"><a href="#å…ˆçœ‹ä¸€ä¸‹npmåœ¨å“ª" class="headerlink" title="å…ˆçœ‹ä¸€ä¸‹npmåœ¨å“ª"></a>å…ˆçœ‹ä¸€ä¸‹npmåœ¨å“ª</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> npm</span><br></pre></td></tr></table></figure><p>ä¸å‡ºæ„æ–™çš„æƒ…å†µä¸‹ä¼šæ˜¾ç¤ºä»¥ä¸‹å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/npm</span><br><span class="line">/mnt/c/Program Files/nodejs//npm</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡æ˜¯npmåœ¨WSLä¸­çš„ä½ç½®ï¼Œç¬¬äºŒæ¡æ˜¯npmåœ¨Windowsä¸­çš„ä½ç½®ï¼ˆå–å†³äºä½ å®‰è£…æ—¶é€‰æ‹©çš„ä½ç½®ï¼‰</p><hr><h3 id="æ·»åŠ ç¯å¢ƒå˜é‡"><a href="#æ·»åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="æ·»åŠ ç¯å¢ƒå˜é‡"></a>æ·»åŠ ç¯å¢ƒå˜é‡</h3><p>å› ä¸ºæˆ‘ç”¨çš„æ˜¯zshï¼Œè¯´ä¸€ä¸‹å¦‚ä½•æ·»åŠ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi ~/.zshrc</span><br></pre></td></tr></table></figure><p>åœ¨ .zshrc æ·»åŠ ä¸€è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:usr/bin</span><br></pre></td></tr></table></figure><p>ç„¶åç”¨ source å‘½ä»¤åˆ·æ–°ä¸€ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure><p><em>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯bashå¯èƒ½ä¸éœ€è¦æ·»åŠ ç¯å¢ƒå˜é‡è¿™ä¸€æ­¥</em></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.jianshu.com/p/a480b99741f6" target="_blank" rel="noopener">Ubuntu/debianç³»å®‰è£…nodejsç¯å¢ƒ</a></p><p><a href="https://www.jianshu.com/p/48c022928771" target="_blank" rel="noopener">zshæ·»åŠ ç¯å¢ƒå˜é‡</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç¯å¢ƒç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒç®€ä»‹&quot;&gt;&lt;/a&gt;ç¯å¢ƒç®€ä»‹&lt;/h2&gt;&lt;h3 id=&quot;ç³»ç»Ÿç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#ç³»ç»Ÿç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;ç³»ç»Ÿç¯å¢ƒ&quot;&gt;&lt;/a
      
    
    </summary>
    
    
      <category term="Deploy" scheme="http://blog.iavjkaede.com/categories/Deploy/"/>
    
    
      <category term="WSL" scheme="http://blog.iavjkaede.com/tags/WSL/"/>
    
      <category term="Debian" scheme="http://blog.iavjkaede.com/tags/Debian/"/>
    
      <category term="Npm" scheme="http://blog.iavjkaede.com/tags/Npm/"/>
    
      <category term="Nodejs" scheme="http://blog.iavjkaede.com/tags/Nodejs/"/>
    
  </entry>
  
  <entry>
    <title>NetCore ä½¿ç”¨ ImageSharp ä¸ºå›¾ç‰‡æ·»åŠ æ°´å°</title>
    <link href="http://blog.iavjkaede.com/2020/05/18/NetCore%20ImageSharp%20Watermark/"/>
    <id>http://blog.iavjkaede.com/2020/05/18/NetCore%20ImageSharp%20Watermark/</id>
    <published>2020-05-18T15:22:37.125Z</published>
    <updated>2020-05-23T08:52:22.087Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒç®€ä»‹"><a href="#ç¯å¢ƒç®€ä»‹" class="headerlink" title="ç¯å¢ƒç®€ä»‹"></a>ç¯å¢ƒç®€ä»‹</h2><h3 id="ç³»ç»Ÿç¯å¢ƒ"><a href="#ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒ"></a>ç³»ç»Ÿç¯å¢ƒ</h3><p>Windows10 1903</p><h3 id="NetCore-SDK-ç‰ˆæœ¬"><a href="#NetCore-SDK-ç‰ˆæœ¬" class="headerlink" title=".NetCore SDK ç‰ˆæœ¬"></a>.NetCore SDK ç‰ˆæœ¬</h3><p>.NetCore 2.2</p><h3 id="ImageSharp-ç‰ˆæœ¬"><a href="#ImageSharp-ç‰ˆæœ¬" class="headerlink" title="ImageSharp ç‰ˆæœ¬"></a>ImageSharp ç‰ˆæœ¬</h3><p>SixLabors.ImageSharp  1.0.0-beta0006</p><h2 id="1-å®‰è£…ImageSharp-Nuget-åŒ…"><a href="#1-å®‰è£…ImageSharp-Nuget-åŒ…" class="headerlink" title="1.å®‰è£…ImageSharp Nuget åŒ…"></a>1.å®‰è£…ImageSharp Nuget åŒ…</h2><p>æˆ‘å†™è¿™ç¯‡åšå®¢æ—¶ï¼ŒImageSharpè¿˜æ²¡æœ‰ä¸€ä¸ªæ­£å¼çš„å‘å¸ƒç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨çš„æ˜¯é¢„è§ˆç‰ˆæœ¬ã€‚</p><p>å¦‚æœé€šè¿‡Visual Studio å®‰è£…Nuget åŒ…ï¼Œè®°å¾—å‹¾é€‰<strong>åŒ…å«é¢„å‘è¡Œç‰ˆæœ¬</strong>ã€‚å¦‚æœä¸çŸ¥é“ImageSharp æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å…ˆç™¾åº¦ä¸€ä¸‹ã€‚</p><p><a href="https://github.com/SixLabors/ImageSharp" target="_blank" rel="noopener">ImageSharp é¡¹ç›®çš„ github åœ°å€</a></p><p>é€šè¿‡CLR å®‰è£…ImageSharp</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet add <span class="string">'é¡¹ç›®åç§°'</span> package SixLabors.ImageSharp --version 1.0.0-beta0006</span><br></pre></td></tr></table></figure><h2 id="2-ç¼–å†™æ·»åŠ æ°´å°çš„ä»£ç "><a href="#2-ç¼–å†™æ·»åŠ æ°´å°çš„ä»£ç " class="headerlink" title="2. ç¼–å†™æ·»åŠ æ°´å°çš„ä»£ç "></a>2. ç¼–å†™æ·»åŠ æ°´å°çš„ä»£ç </h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Stream <span class="title">Watermark</span>(<span class="params">Stream origin, Stream mark, <span class="keyword">string</span> position, <span class="keyword">float</span> scale, <span class="keyword">float</span> opacity</span>)</span></span><br><span class="line"><span class="function"></span> &#123;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// <span class="doctag">TODO:</span> å‚æ•°æ ¡éªŒ</span></span><br><span class="line">     <span class="comment">// origin mark ä¸å¯ç©ºï¼Œ</span></span><br><span class="line">     <span class="comment">// position å¯æŒ‡å®šé»˜è®¤å€¼</span></span><br><span class="line">     <span class="comment">// scale opacity ä¸å¯å°äºç­‰äº0</span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">using</span>(<span class="keyword">var</span> originImage = Image.Load(origin))</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">using</span>(<span class="keyword">var</span> markImage = Image.Load(mark))</span><br><span class="line">         &#123;</span><br><span class="line">             <span class="comment">// è®¾ç½®æ°´å°çš„å¤§å°ï¼Œå¦‚æœå›¾ç‰‡å®½å¤§äºé«˜ï¼Œ scaleç¼©æ”¾çš„æ˜¯æ°´å°å›¾çš„å®½åº¦ï¼Œå¦åˆ™å°†åº”ç”¨åˆ°é«˜åº¦ä¸Š</span></span><br><span class="line">             <span class="keyword">float</span> markWidth = originImage.Width * scale;</span><br><span class="line">             <span class="keyword">if</span> (originImage.Width &lt; originImage.Height)</span><br><span class="line">                 markWidth = originImage.Height * scale;</span><br><span class="line"></span><br><span class="line">             <span class="comment">// å¯¹æ°´å°å›¾ç‰‡è¿›è¡Œç­‰æ¯”ç¼©æ”¾</span></span><br><span class="line">             <span class="keyword">float</span> ratio = markWidth / markImage.Width;</span><br><span class="line">             <span class="keyword">float</span> markHeight = markImage.Height * ratio;</span><br><span class="line"></span><br><span class="line">             markImage.Mutate(mk =&gt;</span><br><span class="line">                 mk.Resize((<span class="keyword">int</span>)markWidth, (<span class="keyword">int</span>)markHeight)</span><br><span class="line"></span><br><span class="line">             );</span><br><span class="line"></span><br><span class="line">             <span class="comment">// æ ¹æ®position è®¡ç®—æ°´å°ä½ç½®  </span></span><br><span class="line">             <span class="comment">// positionå¯èƒ½çš„å€¼å¦‚ä¸‹ "left top botom center right"</span></span><br><span class="line">             <span class="comment">// è¿™äº›å€¼å¯ä»¥è¿›è¡Œç»„åˆ å¦‚æœåŒä¸€æ–¹å‘æœ‰é‡å¤å€¼ï¼Œåé¢çš„ä¼šè¦†ç›–æ‰å‰é¢çš„ </span></span><br><span class="line">             <span class="comment">// æŒ‰ç…§ ä¸­å·¦ä¸Šå³ä¸‹çš„é¡ºåºå¤„ç†</span></span><br><span class="line">             position = position.ToLower();</span><br><span class="line">             Point point = <span class="keyword">new</span> Point();</span><br><span class="line"></span><br><span class="line">             <span class="keyword">if</span> (position.Contains(<span class="string">"center"</span>))</span><br><span class="line">             &#123;</span><br><span class="line">                 point.X = (originImage.Width - markImage.Width) / <span class="number">2</span>;</span><br><span class="line">                 point.Y = (originImage.Height - markImage.Height) / <span class="number">2</span>;</span><br><span class="line">             &#125;</span><br><span class="line"></span><br><span class="line">             <span class="keyword">if</span> (position.Contains(<span class="string">"left"</span>))</span><br><span class="line">                 point.X = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">             <span class="keyword">if</span> (position.Contains(<span class="string">"top"</span>))</span><br><span class="line">                 point.Y = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">             <span class="keyword">if</span> (position.Contains(<span class="string">"right"</span>))</span><br><span class="line">                 point.X = originImage.Width - markImage.Width;</span><br><span class="line"></span><br><span class="line">             <span class="keyword">if</span> (position.Contains(<span class="string">"bottom"</span>))</span><br><span class="line">                 point.Y = originImage.Height - markImage.Height;</span><br><span class="line"></span><br><span class="line">             <span class="comment">// æŠŠæ°´å°åŠ åˆ°å›¾ç‰‡ä¸Š</span></span><br><span class="line">             originImage.Mutate(oi =&gt;</span><br><span class="line">             &#123;</span><br><span class="line">                 oi.DrawImage(markImage, point, opacity);</span><br><span class="line">             &#125;);</span><br><span class="line"></span><br><span class="line">             origin.Position = <span class="number">0</span>;</span><br><span class="line">             <span class="keyword">var</span> format  = Image.DetectFormat(origin);</span><br><span class="line">             <span class="keyword">var</span> encoder = Configuration.Default.ImageFormatsManager.FindEncoder(format);</span><br><span class="line">             <span class="keyword">var</span> outStream = <span class="keyword">new</span> MemoryStream();</span><br><span class="line"></span><br><span class="line">             originImage.Save(outStream, encoder);</span><br><span class="line">             origin.Position    = <span class="number">0</span>;</span><br><span class="line">             mark.Position      = <span class="number">0</span>;</span><br><span class="line">             outStream.Position = <span class="number">0</span>;</span><br><span class="line">             <span class="keyword">return</span> outStream;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>ImageSharp çš„ä½¿ç”¨èµ·æ¥å¾ˆç®€å•æ–¹ä¾¿ï¼Œæœ‰å…³æ›´å¤šä½¿ç”¨ImageSharpçš„ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒ<a href="https://docs.sixlabors.com/articles/ImageSharp/GettingStarted.html" target="_blank" rel="noopener">ImageSharp çš„æ–‡æ¡£</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç¯å¢ƒç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒç®€ä»‹&quot;&gt;&lt;/a&gt;ç¯å¢ƒç®€ä»‹&lt;/h2&gt;&lt;h3 id=&quot;ç³»ç»Ÿç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#ç³»ç»Ÿç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;ç³»ç»Ÿç¯å¢ƒ&quot;&gt;&lt;/a
      
    
    </summary>
    
    
      <category term=".NET" scheme="http://blog.iavjkaede.com/categories/NET/"/>
    
    
      <category term=".NET" scheme="http://blog.iavjkaede.com/tags/NET/"/>
    
      <category term="Image" scheme="http://blog.iavjkaede.com/tags/Image/"/>
    
  </entry>
  
  <entry>
    <title>.NetCore Web é¡¹ç›®çš„æ’ä»¶å®ç°</title>
    <link href="http://blog.iavjkaede.com/2020/05/18/NetCore%20Web%20Plugins/"/>
    <id>http://blog.iavjkaede.com/2020/05/18/NetCore%20Web%20Plugins/</id>
    <published>2020-05-18T15:22:37.125Z</published>
    <updated>2020-06-21T13:19:43.247Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸ºä»€ä¹ˆä½¿ç”¨æ’ä»¶çš„æ–¹å¼å»å®Œæˆé¡¹ç›®ï¼Ÿå¹¶ä¸æ˜¯å› ä¸ºè¿™å¾ˆé…·ï¼Œä»…ä»…æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›é¡¹ç›®å˜å¾—æ›´å®¹æ˜“ç»´æŠ¤ï¼Œæ›´å®¹æ˜“æ‹“å±•ï¼Œå½¼æ­¤ä¹‹é—´çš„ä¾èµ–æ›´æ¸…æ™°æ›´ç®€å•ã€‚ä½¿ç”¨æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸å½±å“ç°æœ‰åŠŸèƒ½æƒ…å†µä¸‹å»å¼€å‘æ–°çš„åŠŸèƒ½ï¼Œéšæ„æ›¿æ¢ç°æœ‰çš„åŠŸèƒ½æ¨¡å—ï¼Œè¿é‡æ–°ç¼–è¯‘éƒ½ä¸éœ€è¦ã€‚çœ‹èµ·æ¥ç¡®å®æŒºé…·ï¼Œè¿™ä¹ˆé…·çš„åŠŸèƒ½ï¼Œåœ¨C#ä¸­å®ç°èµ·æ¥å´å¹¶ä¸å¤æ‚ã€‚å—¯ï¼Œé‚£å°±åˆ†äº«ä¸€ä¸‹æˆ‘åœ¨.NetCore é¡¹ç›®ä¸­ä½¿ç”¨æ’ä»¶çš„æ–¹å¼ã€‚</p><h2 id="ç¯å¢ƒç®€ä»‹"><a href="#ç¯å¢ƒç®€ä»‹" class="headerlink" title="ç¯å¢ƒç®€ä»‹"></a>ç¯å¢ƒç®€ä»‹</h2><h3 id="ç³»ç»Ÿç¯å¢ƒ"><a href="#ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒ"></a>ç³»ç»Ÿç¯å¢ƒ</h3><p>Windows 10 LTSC 2019</p><h3 id="å¼€å‘ç¯å¢ƒ"><a href="#å¼€å‘ç¯å¢ƒ" class="headerlink" title="å¼€å‘ç¯å¢ƒ"></a>å¼€å‘ç¯å¢ƒ</h3><p>SDKï¼š .NetCore 2.2</p><p>Databaseï¼šSQLite 3</p><h3 id="å¼€å‘å·¥å…·"><a href="#å¼€å‘å·¥å…·" class="headerlink" title="å¼€å‘å·¥å…·"></a>å¼€å‘å·¥å…·</h3><p>Editorï¼šVisual Studio Code</p><p>Shellï¼šPowershell</p><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><h3 id="é¡¹ç›®å‡†å¤‡"><a href="#é¡¹ç›®å‡†å¤‡" class="headerlink" title="é¡¹ç›®å‡†å¤‡"></a>é¡¹ç›®å‡†å¤‡</h3><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å»åˆ›å»ºä»¥ä¸‹é¡¹ç›®ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mkdir PluginDemo</span><br><span class="line">cd PluginDemo</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿è¯ä½¿ç”¨çš„æ˜¯2.2ç‰ˆæœ¬çš„.netcore sdk</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨ dotnet --list-sdks æŸ¥çœ‹å·²å®‰è£…çš„.netcore ç‰ˆæœ¬</span></span><br><span class="line">dotnet new global.json -<span class="literal">-sdk</span><span class="literal">-version</span> <span class="number">2.2</span>.<span class="number">204</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé¡¹ç›®</span></span><br><span class="line">dotnet new web <span class="literal">-o</span> Host</span><br><span class="line">dotnet new classlib <span class="literal">-o</span> Share</span><br><span class="line">dotnet new classlib <span class="literal">-o</span> Plugin1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å¼•ç”¨</span></span><br><span class="line">dotnet add .\Host\ reference .\Share\</span><br><span class="line">dotnet add .\Plugin1\ reference .\Share\</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ VS Code ä¸­æ‰“å¼€</span></span><br><span class="line">code ./</span><br></pre></td></tr></table></figure><p>æŒ‰ä¸‹<code>F5</code>è¿›è¡Œè°ƒè¯•ï¼Œä¿è¯é¡¹ç›®æˆåŠŸå¯åŠ¨ã€‚</p><p>è¿™é‡Œåˆ›å»ºäº†ä¸‰ä¸ªé¡¹ç›®ï¼Œåˆ†åˆ«æ˜¯<strong>Host</strong>ã€<strong>Plugin1</strong>ã€<strong>Share</strong>ï¼Œä¾èµ–å…³ç³»å¦‚ä¸‹</p><p>Host &lt;- Share</p><p>Plugin1 &lt;- Share</p><h3 id="æ•°æ®åº“å‡†å¤‡"><a href="#æ•°æ®åº“å‡†å¤‡" class="headerlink" title="æ•°æ®åº“å‡†å¤‡"></a>æ•°æ®åº“å‡†å¤‡</h3><p>åœ¨çœŸæ­£å¼€å§‹ä¹‹å‰ï¼Œæœ€å¥½éƒ¨ç½²ä¸€ä¸ªå¯ç”¨çš„æ•°æ®åº“ï¼Œå› ä¸ºåé¢çš„Modelæ˜ å°„ä¼šç”¨åˆ°ã€‚</p><h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><p>å‡†å¤‡å¥½äº†å—ï¼Ÿå‡†å¤‡å¥½é‚£å¯å°±å¼€å§‹äº†ã€‚ğŸš€</p><h3 id="åŠ è½½Controller"><a href="#åŠ è½½Controller" class="headerlink" title="åŠ è½½Controller"></a>åŠ è½½Controller</h3><p>é¦–å…ˆè¦åšåˆ°çš„ä¸€ç‚¹å°±æ˜¯ï¼ŒæŠŠç¼–å†™çš„ç¨‹åºé›†ï¼ˆå…¶ä¸­åŒ…å«ç»§æ‰¿è‡ªControllerçš„å­ç±»ï¼‰ä¸¢åˆ°å®šä¹‰çš„æ’ä»¶ç›®å½•ï¼Œé‡å¯åº”ç”¨åï¼Œç¨‹åºé›†ä¸­çš„Controllerèƒ½å¤Ÿè¢«æˆåŠŸè·¯ç”±ã€‚</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œç”¨<strong>ApplicationPart</strong>æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><h4 id="ä¿®æ”¹Startup-cs"><a href="#ä¿®æ”¹Startup-cs" class="headerlink" title="ä¿®æ”¹Startup.cs*"></a>ä¿®æ”¹Startup.cs*</h4><p>é¡¹ç›® â€“ <strong>Host</strong></p><p>ç¼–è¾‘<strong>Startup.cs</strong> ä¸­çš„<code>ConfigureServices</code>æ–¹æ³•ä¸­ä½¿ç”¨ä»¥ä¸‹ä»£ç é…ç½®MVC</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    .....</span><br><span class="line">        </span><br><span class="line">    services.AddMvc().ConfigureApplicationPartManager(manager =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">string</span> path = Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location);</span><br><span class="line">        <span class="keyword">var</span> assmeblyFiles = Directory.GetFiles (path, <span class="string">"*.dll"</span>);</span><br><span class="line">        assmeblyFiles.Select(AssemblyLoadContext.Default.LoadFromAssemblyPath)</span><br><span class="line">            .ToList().ForEach(assmebly =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (assmebly.GetTypes().Any(<span class="keyword">typeof</span>(Controller).IsAssignableFrom))</span><br><span class="line">                &#123;</span><br><span class="line">                        AssemblyPart part = <span class="keyword">new</span> AssemblyPart(assmebly);</span><br><span class="line">                        manager.ApplicationParts.Add(part);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    .....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">IApplicationBuilder app, IHostingEnvironment env</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (env.IsDevelopment())</span><br><span class="line">    &#123;</span><br><span class="line">        app.UseDeveloperExceptionPage();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    app.Run(async (context) =&gt;</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        await context.Response.WriteAsync("Hello World!");</span></span><br><span class="line"><span class="comment">    &#125;);*/</span></span><br><span class="line">    app.UseMvc();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€˜*.dllâ€™ å¯ä»¥ç”¨å¦‚ *.plugin.dll è¿™æ ·çš„å­—ç¬¦ä¸²ä»£æ›¿ï¼Œå–ä¸€ä¸ªæ’ä»¶å‘½åè§„åˆ™ã€‚æœ€å¥½æŠŠè¿™ä¸ªè§„åˆ™æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚</p><p>æ¥ä¸‹æ¥ç¼–å†™ä¸€ä¸ªControllerè¿›è¡Œæµ‹è¯•ã€‚</p><hr><p>é¡¹ç›® â€“ <strong>Plugin1</strong></p><h4 id="æ·»åŠ PluginController-cs"><a href="#æ·»åŠ PluginController-cs" class="headerlink" title="æ·»åŠ PluginController.cs"></a>æ·»åŠ <strong>PluginController.cs</strong></h4><p><strong>PluginController.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">ApiController</span>]</span><br><span class="line">    [<span class="meta">Route (<span class="meta-string">"api/[controller]/[action]"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PluginController</span> : <span class="title">Controller</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PluginController</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">Ping</span>(<span class="params"></span>)</span> =&gt; <span class="string">"pong"</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–å†™å®Œä¹‹åè¿˜éœ€è¦æ·»åŠ MVCçš„NuGetåŒ…ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Plugin1\ package Microsoft.AspNetCore.Mvc</span><br></pre></td></tr></table></figure><p>å®ŒæˆNuGetåŒ…æ·»åŠ åå°±å¯ä»¥æ„å»ºPlugin1é¡¹ç›®äº†ã€‚</p><hr><h4 id="ç¼–å†™tasks-json"><a href="#ç¼–å†™tasks-json" class="headerlink" title="ç¼–å†™tasks.json"></a>ç¼–å†™tasks.json</h4><p>ç­‰ç­‰ï¼Œå¦‚æœä¸æƒ³æ¯æ¬¡éƒ½<code>dotnet build .\Plugin1\</code>ï¼Œè¿˜éœ€è¦é…ç½®ä¸‹<strong>tasks.json</strong></p><p>ç¬¬ä¸€æ¬¡<code>F5</code>è°ƒè¯•çš„æ—¶å€™ä¼šé…ç½®æ„å»ºä»»åŠ¡ç”Ÿæˆè¯¥æ–‡ä»¶ã€‚</p><p><strong>tasks.json</strong>ä¸­é»˜è®¤æ·»åŠ äº†ä¸‰ä¸ªä»»åŠ¡<code>buildï¼Œpublishï¼Œwatch</code>ï¼Œç°åœ¨æ·»åŠ <strong>Plugin1</strong>çš„æ„å»ºä»»åŠ¡ã€‚</p><p>ç¼–è¾‘<strong>tasks.json</strong> åŠ å…¥ä»¥ä¸‹å†…å®¹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"label"</span>: <span class="string">"build plugin1"</span>,</span><br><span class="line">    <span class="attr">"command"</span>: <span class="string">"dotnet"</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"process"</span>,</span><br><span class="line">    <span class="attr">"args"</span>: [</span><br><span class="line">        <span class="string">"build"</span>,</span><br><span class="line">        <span class="string">"$&#123;workspaceFolder&#125;/Plugin1/Plugin1.csproj"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"problemMatcher"</span>: <span class="string">"$tsc"</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"label"</span>: <span class="string">"build &amp; install plugin1"</span>,</span><br><span class="line">    <span class="attr">"command"</span>: <span class="string">"cp"</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"shell"</span>,</span><br><span class="line">    <span class="attr">"args"</span>: [</span><br><span class="line">        <span class="string">"$&#123;workspaceFolder&#125;/Plugin1/bin/Debug/netstandard2.0/Plugin1.dll"</span>,</span><br><span class="line">        <span class="string">"$&#123;workspaceFolder&#125;/Host/bin/Debug/netcoreapp2.2/Plugin1.dll"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"windows"</span>: &#123;</span><br><span class="line">        <span class="attr">"command"</span>: <span class="string">"xcopy"</span>,</span><br><span class="line">        <span class="attr">"args"</span>: [</span><br><span class="line">            <span class="string">"/y"</span>,</span><br><span class="line">            <span class="string">"$&#123;workspaceFolder&#125;\\Plugin1\\bin\\Debug\\netstandard2.0\\Plugin1.dll"</span>,</span><br><span class="line">            <span class="string">"$&#123;workspaceFolder&#125;\\Host\\bin\\Debug\\netcoreapp2.2\\Plugin1.dll"</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"dependsOn"</span>: [</span><br><span class="line">        <span class="string">"build plugin1"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"problemMatcher"</span>: <span class="string">"$tsc"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨VS Codeä¸­æ‰§è¡Œä»»åŠ¡<strong>build &amp; install plugin1</strong> </p><p><code>ctrl+shift+p</code>  è¾“å…¥ <code>run task</code> é€‰æ‹© <code>build &amp; install plugin1</code></p><p><em>æ³¨æ„ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œå‘½ä»¤å¯èƒ½ä¼šè¯¢é—®æ˜¯å¤åˆ¶çš„æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹ï¼Œåœ¨ä»»åŠ¡ç»ˆç«¯ä¸­ï¼Œè¾“å…¥<code>F</code>ç¡®å®šæ˜¯æ–‡ä»¶å³å¯ã€‚</em></p><p>æ‰§è¡ŒæˆåŠŸååœ¨<strong>Host</strong>çš„<code>bin/Debug/netcoreapp2.2</code>ç›®å½•ä¸‹ç„ä¸€çœ¼æœ‰æ²¡æœ‰Plugin1.dllï¼Œæœ‰çš„è¯å°±ğŸ‘Œã€‚</p><hr><h4 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h4><p><code>F5</code>å¯åŠ¨é¡¹ç›®ï¼Œç„¶ååœ¨æµè§ˆå™¨è¾“å…¥<a href="https://5001/api/plugin/pingã€‚" target="_blank" rel="noopener">https://5001/api/plugin/pingã€‚</a></p><p>å½“çœ‹åˆ°æµè§ˆå™¨å›å¤äº†ä¸€ä¸ªâ€™pongâ€™ ä¹‹åï¼Œæ„å‘³ç€ï¼ŒæˆåŠŸäº†ğŸ˜€ã€‚</p><h3 id="æ³¨å…¥Services"><a href="#æ³¨å…¥Services" class="headerlink" title="æ³¨å…¥Services"></a>æ³¨å…¥Services</h3><p>Plugin1.dll é™¤äº†éœ€è¦å“åº”è¯·æ±‚ä¹‹å¤–ï¼Œå®ƒè¿˜éœ€è¦ä½¿ç”¨IOCå®¹å™¨è¿›è¡ŒDIã€‚.NetCore å·²ç»å†…ç½®äº†IOCå®¹å™¨ï¼Œéœ€è¦è§£å†³çš„é—®é¢˜å°±æ˜¯ï¼šæ€ä¹ˆæŠŠè¿™ä¸ªå®¹å™¨ä¼ é€’ç»™æ’ä»¶ğŸ¤”ã€‚è¿™é‡Œä½¿ç”¨åå°„æ¥å®Œæˆå®ƒã€‚</p><p>æ€è·¯æ˜¯è¿™æ ·ï¼Œå®šä¹‰ä¸€ä¸ªç”¨æ¥æ³¨å…¥æœåŠ¡çš„æ¥å£ã€‚åœ¨<strong>Host</strong>é¡¹ç›®ä¸­ï¼Œéœ€è¦éå†æ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç¨‹åºé›†å¹¶è°ƒç”¨æ³¨å…¥æ–¹æ³•ï¼Œç„¶ååœ¨æ’ä»¶é¡¹ç›®ä¸­å®ç°è¯¥æ¥å£ã€‚å½“ç„¶ï¼Œè¿™ä¸ªæ¥å£éœ€è¦æ”¾åœ¨<strong>Share</strong>é¡¹ç›®ä¸­ã€‚</p><h4 id="ç”¨æ¥æ³¨å…¥çš„æ¥å£"><a href="#ç”¨æ¥æ³¨å…¥çš„æ¥å£" class="headerlink" title="ç”¨æ¥æ³¨å…¥çš„æ¥å£*"></a>ç”¨æ¥æ³¨å…¥çš„æ¥å£*</h4><p>é¡¹ç›® â€“ <strong>Share</strong></p><p>åœ¨VS Code ä¸­æ–°å»º<strong>IServicesRegister.cs</strong></p><p><strong>IServicesRegister.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Share</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IServicesRegister</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">RegisterServices</span>(<span class="params">IServiceCollection services</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜éœ€è¦æ·»åŠ <strong>Microsoft.Extensions.DependencyInjection</strong> NuGet åŒ…ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Share\ package Microsoft.Extensions.DependencyInjection</span><br></pre></td></tr></table></figure><p><em>å‘½ä»¤æ˜¯åœ¨<strong>PluginDemo</strong> è·¯å¾„ä¸‹æ‰§è¡Œçš„ï¼Œå¯ä¸è¦æ··äº†ã€‚</em></p><p>è¿™ä¸ªæ¥å£æå…¶ç®€å•ï¼Œåªæœ‰ä¸€ä¸ª<code>RegisterServices</code>çš„æ–¹æ³•ï¼Œæˆ‘è¿™é‡Œä¿è¯è¿™ä¸ªæ¥å£æœ‰ä¸”åªæœ‰è¿™ä¸€ä¸ªæ–¹æ³•ï¼Œæ–¹ä¾¿å¾…ä¼šèƒ½æ‰¾åˆ°å®ƒã€‚</p><hr><h4 id="å®Œæˆæ³¨å…¥"><a href="#å®Œæˆæ³¨å…¥" class="headerlink" title="å®Œæˆæ³¨å…¥*"></a>å®Œæˆæ³¨å…¥*</h4><p>ç°åœ¨åœ¨<strong>Startup.cs</strong>ä¸­æ·»åŠ ä¸€ä¸ª<code>RegisterServices</code>æ–¹æ³•ï¼ˆåå­—æ˜¯å’Œæ¥å£çš„é‡å¤çš„ï¼Œè¿™æ²¡å…³ç³»ï¼Œä¸è¦æ··æ·†äº†å³å¯ï¼‰,æˆ–è€…å¯ä»¥ç›´æ¥<code>ConfigureServices</code> ä¸­æ“ä½œã€‚</p><p><strong>Startup.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// æœ€å¥½æ˜¯åœ¨æœ€åä¸€æ­¥å»æ³¨å…¥è¿™äº›æœåŠ¡</span></span><br><span class="line">    RegisterServices(services);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegisterServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾dllæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">var</span> dllFiles = Directory.GetFiles(Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location), <span class="string">"*.dll"</span>);</span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾ç¨‹åºé›†</span></span><br><span class="line">    <span class="keyword">var</span> assemblies = dllFiles.Select(AssemblyLoadContext.Default.LoadFromAssemblyPath).ToList();</span><br><span class="line">    assemblies.ForEach(ass =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è·å–å®ç°IServiceRegister æ¥å£çš„ç±»å‹</span></span><br><span class="line">        <span class="keyword">var</span> registers = ass.GetTypes().Where(m =&gt; m.IsClass &amp;&amp; <span class="keyword">typeof</span>(IServicesRegister).IsAssignableFrom(m)).ToList();</span><br><span class="line">        registers.ForEach(reg =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> instance = Activator.CreateInstance(reg);</span><br><span class="line">            <span class="comment">// æ–¹æ³• ä¿è¯è¯¥æ¥å£ä»…æœ‰ä¸€ä¸ªæ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨SingleOrDefaultï¼Œåº”è¯¥ç”¨Singleã€‚</span></span><br><span class="line">            <span class="keyword">var</span> method = <span class="keyword">typeof</span>(IServicesRegister).GetMethods().SingleOrDefault();</span><br><span class="line">            </span><br><span class="line">            method.Invoke(instance, <span class="keyword">new</span> <span class="keyword">object</span>[]</span><br><span class="line">            &#123;</span><br><span class="line">                services</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><hr><h4 id="ç¼–å†™Serviceè¿›è¡Œæµ‹è¯•"><a href="#ç¼–å†™Serviceè¿›è¡Œæµ‹è¯•" class="headerlink" title="ç¼–å†™Serviceè¿›è¡Œæµ‹è¯•"></a>ç¼–å†™Serviceè¿›è¡Œæµ‹è¯•</h4><p>é¡¹ç›® â€“ <strong>Plugin1</strong></p><p>éœ€è¦æ·»åŠ ä¸‰ä¸ªæ–‡ä»¶</p><ul><li>ServicesRegister.cs</li><li>IAddService.cs</li><li>AddService.cs</li></ul><p><strong>ServicesRegister.cs</strong> ç”¨æ¥å®ç°æ³¨å…¥ï¼Œ<strong>AddService.cs</strong> å°†å®ç° IAddService æ¥å£ç”¨æ¥æµ‹è¯•ã€‚</p><p><strong>ServicesRegister.cs</strong> </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"><span class="keyword">using</span> Share;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ServicesRegister</span> : <span class="title">IServicesRegister</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegisterServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Debug.WriteLine(<span class="string">"Register plugin1's services"</span>, <span class="string">"info: "</span>);</span><br><span class="line"></span><br><span class="line">            services.AddTransient&lt;IAddService,AddService&gt;();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>IAddService.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IAddService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">string</span> <span class="title">Add</span>(<span class="params"><span class="keyword">string</span> a, <span class="keyword">string</span> b</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>AddService.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AddService</span> : <span class="title">IAddService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">Add</span>(<span class="params"><span class="keyword">string</span> a, <span class="keyword">string</span> b</span>)</span> =&gt; a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åä¿®æ”¹<strong>PluginController.cs</strong> æ·»åŠ AddServiceçš„æ³¨å…¥ä¾èµ–å’Œæµ‹è¯•æ–¹æ³•ã€‚</p><p><strong>PluginController.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">ApiController</span>]</span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">"api/[controller]/[action]"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PluginController</span> : <span class="title">Controller</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">readonly</span> IAddService m_addService;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PluginController</span>(<span class="params">IAddService addService</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_addService = addService;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">Ping</span>(<span class="params"></span>)</span> =&gt; <span class="string">"pong"</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">PingService</span>(<span class="params"><span class="keyword">string</span> a, <span class="keyword">string</span> b</span>)</span> =&gt; m_addService.Add(a, b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="å¯åŠ¨-1"><a href="#å¯åŠ¨-1" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h4><p>å…ˆæ‰§è¡Œ <code>build &amp; install plugin1</code>å‘½ä»¤ï¼Œç„¶å<code>F5</code>å¯åŠ¨ã€‚ğŸš€</p><p>ä¸€åˆ‡å®Œæˆï¼Œåœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥<a href="https://localhost:5001/api/plugin/pingservice?a=service&amp;b=doneã€‚" target="_blank" rel="noopener">https://localhost:5001/api/plugin/pingservice?a=service&amp;b=doneã€‚</a></p><p>çœ‹çœ‹æµè§ˆå™¨å“åº”ï¼Œæ˜¯å¦æŠŠâ€™serviceâ€™ å’Œ â€˜doneâ€™ æ‹¼åˆ°ä¸€èµ·äº†å‘¢ã€‚</p><p>å†å»è°ƒè¯•æ§åˆ¶å°çœ‹æ‰“å°çš„<code>Debug.WriteLine(&quot;Register plugin1&#39;s services&quot;, &quot;info: &quot;);</code> æœ‰æ²¡æœ‰æ­£ç¡®è¾“å‡ºã€‚ğŸ‘ğŸ‘ğŸ‘</p><h3 id="ç‹¬ç«‹é…ç½®æ–‡ä»¶"><a href="#ç‹¬ç«‹é…ç½®æ–‡ä»¶" class="headerlink" title="ç‹¬ç«‹é…ç½®æ–‡ä»¶"></a>ç‹¬ç«‹é…ç½®æ–‡ä»¶</h3><p>å½“å†³å®šè®©æ’ä»¶æˆä¸ºä¸€ä¸ªå®Œæ•´ç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—æ—¶ï¼Œæ’ä»¶åº”è¯¥ä½¿ç”¨ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®è¿‡ç¨‹å’Œæ™®é€šçš„é¡¹ç›®é…ç½®æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œè¿™é‡Œå°±ç®€å•è®²ä¸€ä¸‹ã€‚</p><p>é¡¹ç›® â€“ <strong>Plugin1</strong></p><p>æ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶</p><ul><li>plugin1.json</li><li>Plugin1Config.cs</li></ul><h4 id="ServicesRegister-csä¸­é…Config"><a href="#ServicesRegister-csä¸­é…Config" class="headerlink" title="ServicesRegister.csä¸­é…Config*"></a><strong>ServicesRegister.cs</strong>ä¸­é…Config*</h4><p>ä¿®æ”¹<strong>ServicesRegister.cs</strong> ä¸­ æ–¹æ³•  <em>RegisterServices</em>  å¦‚ä¸‹</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ServicesRegister</span> : <span class="title">IServicesRegister</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegisterServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line"><span class="function"></span>       &#123;</span><br><span class="line">           Debug.WriteLine(<span class="string">"Register plugin1's services"</span>, <span class="string">"info: "</span>);</span><br><span class="line"><span class="comment">// è·¯å¾„å¯ä»¥è‡ªè¡Œé…ç½®</span></span><br><span class="line">           <span class="keyword">var</span> config = <span class="keyword">new</span> ConfigurationBuilder()</span><br><span class="line">               .SetBasePath(Directory.GetCurrentDirectory())</span><br><span class="line">               .AddJsonFile(<span class="string">"plugin1.json"</span>, <span class="literal">false</span>)</span><br><span class="line">               .Build();</span><br><span class="line"></span><br><span class="line">           services.Configure&lt;Plugin1Config&gt;(config.GetSection(<span class="keyword">nameof</span>(Plugin1Config)));</span><br><span class="line"></span><br><span class="line">           services.AddTransient&lt;IAddService, AddService&gt;();</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="Plugin1Config-cs"><a href="#Plugin1Config-cs" class="headerlink" title="Plugin1Config.cs"></a>Plugin1Config.cs</h4><p><strong>Plugin1Config.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Plugin1Config</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Name</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Version</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Author</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ é…ç½®æ–‡ä»¶"><a href="#æ·»åŠ é…ç½®æ–‡ä»¶" class="headerlink" title="æ·»åŠ é…ç½®æ–‡ä»¶"></a>æ·»åŠ é…ç½®æ–‡ä»¶</h4><p><strong>plugin1.json</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"Plugin1Config"</span>:&#123;</span><br><span class="line">        <span class="attr">"Name"</span>:<span class="string">"Plugin1"</span>,</span><br><span class="line">        <span class="attr">"Version"</span>:<span class="string">"1.1"</span>,</span><br><span class="line">        <span class="attr">"Author"</span>:<span class="string">"Your Name"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æƒ³è¦æˆåŠŸæ„å»º<strong>Plugin1</strong>é¡¹ç›®è¿˜éœ€è¦æ·»åŠ ä»¥ä¸‹NuGetåŒ…</p><ul><li>Microsoft.Extensions.Configuration</li><li>Microsoft.Extensions.Configuration.FileExtensions</li><li>Microsoft.Extensions.Configuration.Json</li><li>Microsoft.Extensions.Options.ConfigurationExtensions</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Plugin1\ package  Microsoft.Extensions.Configuration</span><br><span class="line">dotnet add .\Plugin1\ package  Microsoft.Extensions.Configuration.FileExtensions</span><br><span class="line">dotnet add .\Plugin1\ package  Microsoft.Extensions.Configuration.Json</span><br><span class="line">dotnet add .\Plugin1\ package  Microsoft.Extensions.Options.ConfigurationExtensions</span><br></pre></td></tr></table></figure><hr><p>é¡¹ç›® â€“ <strong>Host</strong></p><p>å¦å¤– ï¼Œ<strong>Host</strong> ä¸­è¿˜éœ€è¦åœ¨<strong>Startup.cs</strong>æ–‡ä»¶ <em>ConfigureServices</em>  æ–¹æ³•ä¸­åŠ ä¸Šä¸€è¡Œ</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">services.AddOptions();</span><br></pre></td></tr></table></figure><hr><h4 id="æµ‹è¯•é…ç½®"><a href="#æµ‹è¯•é…ç½®" class="headerlink" title="æµ‹è¯•é…ç½®"></a>æµ‹è¯•é…ç½®</h4><p>emmmï¼ŒControllerçš„ä»£ç çœ‹èµ·æ¥æ˜¯è¿™æ ·ã€‚</p><p><strong>PluginController.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.Options;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">ApiController</span>]</span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">"api/[controller]/[action]"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PluginController</span> : <span class="title">Controller</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">readonly</span> IAddService m_addService;</span><br><span class="line">        <span class="keyword">readonly</span> Plugin1Config m_config;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PluginController</span>(<span class="params">IAddService addService, IOptions&lt;Plugin1Config&gt; options</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_addService = addService;</span><br><span class="line">            m_config = options.Value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">Ping</span>(<span class="params"></span>)</span> =&gt; <span class="string">"pong"</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">PingService</span>(<span class="params"><span class="keyword">string</span> a, <span class="keyword">string</span> b</span>)</span> =&gt; m_addService.Add(a, b);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ActionResult&lt;Plugin1Config&gt; <span class="title">PingConfig</span>(<span class="params"></span>)</span> =&gt; m_config;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ·»åŠ NuGetå¼•ç”¨</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Plugin1\ package  Microsoft.Extensions.Options</span><br></pre></td></tr></table></figure><hr><h4 id="å¯åŠ¨-2"><a href="#å¯åŠ¨-2" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h4><p>ç°åœ¨åƒä¹‹å‰é‚£æ ·æ„å»ºé¡¹ç›®ï¼Œåœ¨å¯åŠ¨é¡¹ç›®ä¹‹å‰ï¼ŒæŠŠ<strong>Plugin1</strong>çš„é…ç½®æ–‡ä»¶<strong>plugin1.json</strong>æ‹·è´åˆ°<strong>Host</strong>ç›®å½•ä¸‹ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œæˆ‘é…ç½®çš„æ˜¯å½“å‰ç›®å½•</span></span><br><span class="line"><span class="keyword">var</span> config = <span class="keyword">new</span> ConfigurationBuilder()</span><br><span class="line">                .SetBasePath(Directory.GetCurrentDirectory())</span><br><span class="line">                .AddJsonFile(<span class="string">"plugin1.json"</span>, <span class="literal">false</span>)</span><br><span class="line">                .Build();</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ä¹‹åï¼Œåœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥<a href="https://localhost:5001/api/plugin/pingconfigã€‚" target="_blank" rel="noopener">https://localhost:5001/api/plugin/pingconfigã€‚</a></p><p>çœ‹çœ‹æœ‰æ²¡æœ‰æ­£å¸¸è¯»å–åˆ°é…ç½®ã€‚ğŸ™‚</p><h3 id="æ˜ å°„Model"><a href="#æ˜ å°„Model" class="headerlink" title="æ˜ å°„Model"></a>æ˜ å°„Model</h3><p>åœ¨æ’ä»¶ä¸­å®ŒæˆæŸäº›æ‹“å±•åŠŸèƒ½æ—¶ï¼Œå¯èƒ½éœ€è¦æ•°æ®åº“çš„è¡¨ç»“æ„æ”¯æŒï¼Œä½†æ˜¯ï¼Œæˆ‘ä¸æƒ³æŠŠæ’ä»¶ä¸­çš„Modelæ”¾åˆ°<strong>Share</strong>é¡¹ç›®ä¸­ï¼Œæ’ä»¶åº”è¯¥è‡ªå·±ç®¡ç†è‡ªå·±çš„Modelã€‚ï¼ˆç©¶ç«Ÿæ˜¯æ”¾åœ¨Shareä¸­è¿˜æ˜¯æ”¾åœ¨æ’ä»¶é¡¹ç›®ä¸­ï¼Œå…·ä½“éœ€è¦çœ‹æ’ä»¶çš„å®šä½ï¼‰</p><p>éœ€è¦å‡†å¤‡ä¸€ä¸ªæ•°æ®åº“ç¯å¢ƒï¼Œæˆ‘è¿™é‡Œä½¿ç”¨SQLiteã€‚</p><h4 id="æ•°æ®åº“è¡¨ç»“æ„"><a href="#æ•°æ®åº“è¡¨ç»“æ„" class="headerlink" title="æ•°æ®åº“è¡¨ç»“æ„"></a>æ•°æ®åº“è¡¨ç»“æ„</h4><p>è¡¨å <em>t_plugdata</em></p><ul><li>Id</li><li>Name</li><li>Data</li></ul><p>ä»»æ„åŠ ä¸€äº›æ•°æ®è¿›å»ï¼Œæ¯”å¦‚</p><table><thead><tr><th>Id</th><th>Name</th><th>Data</th></tr></thead><tbody><tr><td>1</td><td>Ok</td><td>true</td></tr><tr><td>2</td><td>Pity</td><td>I am ok</td></tr><tr><td>3</td><td>Lisa</td><td>Hi,I am here</td></tr></tbody></table><p>ä¿è¯æœ‰ç‚¹æ•°æ®å°±å¥½äº†ï¼Œæœ‰å…³æ•°æ®åº“é“¾æ¥å­—ç¬¦ä¸²æˆ–è€…å…¶ä»–æ¶‰åŠçš„ä¸œè¥¿ä¸åœ¨è¿™é‡Œç»†è®²ã€‚</p><h4 id="é…ç½®æ•°æ®åº“ä¸Šä¸‹æ–‡"><a href="#é…ç½®æ•°æ®åº“ä¸Šä¸‹æ–‡" class="headerlink" title="é…ç½®æ•°æ®åº“ä¸Šä¸‹æ–‡*"></a>é…ç½®æ•°æ®åº“ä¸Šä¸‹æ–‡*</h4><p>é¡¹ç›® â€“ <strong>Share</strong></p><p>æ·»åŠ <strong>HostDbContext.cs</strong></p><p><strong>HostDbContext.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.Loader;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Share</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HostDbContext</span> : <span class="title">DbContext</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">HostDbContext</span>(<span class="params">DbContextOptions options</span>) : <span class="title">base</span>(<span class="params">options</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnModelCreating</span>(<span class="params">ModelBuilder modelBuilder</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">base</span>.OnModelCreating(modelBuilder);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ä¾æ—§æ˜¯ä½¿ç”¨åå°„çš„æ–¹å¼å»å®Œæˆ</span></span><br><span class="line">            <span class="keyword">var</span> dllfiles = Directory.GetFiles(Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location), <span class="string">"*.dll"</span>);</span><br><span class="line">            Array.ForEach(dllfiles, files =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> assembly = AssemblyLoadContext.Default.LoadFromAssemblyPath(files);</span><br><span class="line">                assembly.GetTypes().Where(type =&gt; type.GetInterface(<span class="keyword">typeof</span>(IEntityTypeConfiguration&lt;&gt;).FullName) != <span class="literal">null</span>)</span><br><span class="line">                    .ToList().ForEach(type =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">dynamic</span> instance = Activator.CreateInstance(type);</span><br><span class="line">                        modelBuilder.ApplyConfiguration(instance);</span><br><span class="line">                    &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnConfiguring</span>(<span class="params">DbContextOptionsBuilder optionsBuilder</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!optionsBuilder.IsConfigured)</span><br><span class="line">            &#123;</span><br><span class="line">                optionsBuilder.UseSqlite(<span class="string">"Data Source=./HostDb.db"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„å»º<strong>Share</strong>é¡¹ç›®å¯èƒ½ç”¨åˆ°çš„NuGet åŒ…</p><ul><li>Microsoft.EntityFrameworkCore</li><li>Microsoft.EntityFrameworkCore.SQLite</li><li>System.Runtime.Loader</li><li>System.Linq</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Share\ package  Microsoft.EntityFrameworkCore</span><br><span class="line">dotnet add .\Share\ package  Microsoft.EntityFrameworkCore.SQLite</span><br><span class="line">dotnet add .\Share\ package  System.Runtime.Loader</span><br><span class="line">dotnet add .\Share\ package  System.Linq</span><br></pre></td></tr></table></figure><h4 id="æ˜ å°„Model-å¹¶å®ç°-IEntiyTypeConfigration"><a href="#æ˜ å°„Model-å¹¶å®ç°-IEntiyTypeConfigration" class="headerlink" title="æ˜ å°„Model å¹¶å®ç° IEntiyTypeConfigration*"></a>æ˜ å°„Model å¹¶å®ç° IEntiyTypeConfigration*</h4><p>é¡¹ç›® â€“ <strong>Plugin1</strong></p><p>æ·»åŠ æ–‡ä»¶ <strong>PluginData.cs</strong></p><p><strong>PluginData.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.ComponentModel.DataAnnotations.Schema;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore.Metadata.Builders;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Table(<span class="meta-string">"t_plugdata"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PluginData</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Id</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Name</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Data</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span>;</span><br><span class="line">            <span class="keyword">set</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class PluginDataConfig : IEntityTypeConfiguration&lt;PluginData&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">EntityTypeBuilder&lt;PluginData&gt; builder</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            builder.ToTable(<span class="string">"t_plugdata"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„å»ºPlugin1 éœ€è¦æ·»åŠ çš„NuGet åŒ…</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Plugin1\ package  Microsoft.EntityFrameworkCore</span><br></pre></td></tr></table></figure><h4 id="æ³¨å…¥æ•°æ®åº“ä¸Šä¸‹æ–‡"><a href="#æ³¨å…¥æ•°æ®åº“ä¸Šä¸‹æ–‡" class="headerlink" title="æ³¨å…¥æ•°æ®åº“ä¸Šä¸‹æ–‡"></a>æ³¨å…¥æ•°æ®åº“ä¸Šä¸‹æ–‡</h4><p>é¡¹ç›® â€“ <strong>Host</strong></p><p><strong>Host</strong> ä¸­è¿˜éœ€è¦åœ¨<strong>Startup.cs</strong>æ–‡ä»¶ <em>ConfigureServices</em>  æ–¹æ³•ä¸­åŠ ä¸Šä¸€è¡Œ</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">services.AddDbContext&lt;HostDbContext&gt;();</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•æ•°æ®åº“ä¸Šä¸‹æ–‡"><a href="#æµ‹è¯•æ•°æ®åº“ä¸Šä¸‹æ–‡" class="headerlink" title="æµ‹è¯•æ•°æ®åº“ä¸Šä¸‹æ–‡"></a>æµ‹è¯•æ•°æ®åº“ä¸Šä¸‹æ–‡</h4><p>åœ¨<strong>PluginController.cs</strong>ä¸­è¿›è¡Œæ³¨å…¥å’Œæµ‹è¯•ã€‚</p><p><strong>PluginController.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.Options;</span><br><span class="line"><span class="keyword">using</span> Share;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">ApiController</span>]</span><br><span class="line">    [<span class="meta">Route(<span class="meta-string">"api/[controller]/[action]"</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PluginController</span> : <span class="title">Controller</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">readonly</span> IAddService m_addService;</span><br><span class="line">        <span class="keyword">readonly</span> Plugin1Config m_config;</span><br><span class="line">        <span class="keyword">readonly</span> HostDbContext m_dbContext;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PluginController</span>(<span class="params">IAddService addService,</span></span></span><br><span class="line"><span class="function"><span class="params">            IOptions&lt;Plugin1Config&gt; options,</span></span></span><br><span class="line"><span class="function"><span class="params">            HostDbContext dbContext</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            m_addService = addService;</span><br><span class="line">            m_config = options.Value;</span><br><span class="line">            m_dbContext = dbContext;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">Ping</span>(<span class="params"></span>)</span> =&gt; <span class="string">"pong"</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">PingService</span>(<span class="params"><span class="keyword">string</span> a, <span class="keyword">string</span> b</span>)</span> =&gt; m_addService.Add(a, b);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ActionResult&lt;Plugin1Config&gt; <span class="title">PingConfig</span>(<span class="params"></span>)</span> =&gt; Json(m_config);</span><br><span class="line">        <span class="keyword">public</span> ActionResult&lt;List&lt;PluginData&gt;&gt; PingDb() =&gt; m_dbContext.Set&lt;PluginData&gt;().ToList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯èƒ½éœ€è¦æ·»åŠ çš„NuGetåŒ…</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet add .\Plugin1\  package  System.Linq</span><br></pre></td></tr></table></figure><p>å¯ä»¥è¯´æ˜¯ç»ˆäºå®Œæˆæœ€åä¸€æ­¥äº†ã€‚</p><p>æœ€åä¸€æ­¥ï¼Ÿæˆ‘è¿˜æƒ³è¡¥å……ä¸€ç‚¹ã€‚</p><p><strong>PluginController</strong> <em>PingDb</em> æ–¹æ³•ä¸­ç”¨<code>m_dbContext.Set&lt;PluginData&gt;()</code>è¿™ç§æ–¹æ³•ä½¿ç”¨HostDbContextï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥å†™ä¸€ä¸ªHostDbContextçš„æ‹“å±•ç±»ã€‚å¤§æ¦‚åƒè¿™ä¸ªæ ·å­</p><p><strong>HostDbContextExtensions.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> Share;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Plugin1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">HostDbContextExtensitions</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DbSet&lt;PluginData&gt; <span class="title">PluginDatas</span>(<span class="params"><span class="keyword">this</span> HostDbContext context</span>)</span> =&gt; context.Set&lt;PluginData&gt;();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>emmmï¼Œè¿™æ¬¡æ˜¯å®Œç»“äº†ã€‚</p><h4 id="å¯åŠ¨-3"><a href="#å¯åŠ¨-3" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h4><p>æ„å»ºæ’ä»¶ï¼Œç„¶åå¯åŠ¨é¡¹ç›®ã€‚</p><p>åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥<a href="https://localhost:5001/api/plugin/pingdbã€‚" target="_blank" rel="noopener">https://localhost:5001/api/plugin/pingdbã€‚</a><br>æ€ä¹ˆæ ·ï¼Œæœ‰ç»“æœäº†å—ï¼ŸğŸ‘€</p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>æˆ‘çš„ä¸ªäººè§‚ç‚¹ã€‚</p><p>æˆ‘è§‰å¾—å¯ä»¥ä»ä¸¤ä¸ªæ–¹å‘å»ä½¿ç”¨æ’ä»¶</p><ol><li>Hosté¡¹ç›®åŠŸèƒ½å®Œå¤‡ï¼Œæ’ä»¶åªæ˜¯æ‹“å±•åŠŸèƒ½ã€‚</li><li>Hosté¡¹ç›®å®Œå…¨ä¾èµ–æ’ä»¶å®ç°åŠŸèƒ½</li></ol><p>æ··åˆä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼ä¹Ÿå¥½ï¼Œå•å•åªç”¨å…¶ä¸­ä¸€ä¸ªæ–¹å¼ä¹Ÿå¥½ã€‚éƒ½æ²¡é—®é¢˜ï¼Œå…·ä½“å–å†³äºæ‰‹ä¸­çš„é”®ç›˜ï¼Œä¸æ˜¯ä¹ˆã€‚</p><p>è¿˜æœ‰ä¸€ç‚¹ï¼Œ.NetCore ä¸­å·²ç»æ²¡æœ‰AppDomainçš„æ¦‚å¿µäº†ï¼Œæ’ä»¶æ— æ³•å®ç°çƒ­æ’æ‹”ã€‚</p><p>å®Œç»“ğŸ‘Œã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¸ºä»€ä¹ˆä½¿ç”¨æ’ä»¶çš„æ–¹å¼å»å®Œæˆé¡¹ç›®ï¼Ÿå¹¶ä¸æ˜¯å› ä¸ºè¿™å¾ˆé…·ï¼Œä»…ä»…æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›é¡¹ç›®å˜å¾—æ›´å®¹æ˜“ç»´æŠ¤ï¼Œæ›´å®¹æ˜“æ‹“å±•ï¼Œå½¼æ­¤ä¹‹é—´çš„ä¾èµ–æ›´æ¸…æ™°æ›´ç®€å•ã€‚ä½¿ç”¨æ’ä»¶ï¼Œæˆ‘ä»¬
      
    
    </summary>
    
    
      <category term=".NET" scheme="http://blog.iavjkaede.com/categories/NET/"/>
    
    
      <category term="C#" scheme="http://blog.iavjkaede.com/tags/C/"/>
    
      <category term="Plugins" scheme="http://blog.iavjkaede.com/tags/Plugins/"/>
    
  </entry>
  
  <entry>
    <title>.Net ä¸­MimeType çš„è·å–</title>
    <link href="http://blog.iavjkaede.com/2020/05/18/Get%20MimeType%20via%20.NET/"/>
    <id>http://blog.iavjkaede.com/2020/05/18/Get%20MimeType%20via%20.NET/</id>
    <published>2020-05-18T15:22:37.124Z</published>
    <updated>2020-06-21T13:19:43.246Z</updated>
    
    <content type="html"><![CDATA[<h3 id="NetFramework-ä¸­è·å–-MimeType"><a href="#NetFramework-ä¸­è·å–-MimeType" class="headerlink" title=".NetFramework ä¸­è·å– MimeType"></a>.NetFramework ä¸­è·å– MimeType</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// using System.Web;</span></span><br><span class="line">MimeMapping.GetMimeMapping(filename);</span><br></pre></td></tr></table></figure><h3 id="NetCore-ä¸­è·å–MimeType"><a href="#NetCore-ä¸­è·å–MimeType" class="headerlink" title=".NetCore ä¸­è·å–MimeType"></a>.NetCore ä¸­è·å–MimeType</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//using Microsoft.AspNetCore.StaticFiles;</span></span><br><span class="line">FileExtensionContentTypeProvider fileExtensionContentTypeProvider;</span><br><span class="line"><span class="keyword">string</span> contentType;</span><br><span class="line">fileExtensionContentTypeProvider.TryGetContentType(filename,<span class="keyword">out</span> contentType);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;NetFramework-ä¸­è·å–-MimeType&quot;&gt;&lt;a href=&quot;#NetFramework-ä¸­è·å–-MimeType&quot; class=&quot;headerlink&quot; title=&quot;.NetFramework ä¸­è·å– MimeType&quot;&gt;&lt;/a&gt;.NetFramew
      
    
    </summary>
    
    
      <category term=".NET" scheme="http://blog.iavjkaede.com/categories/NET/"/>
    
    
      <category term="C#" scheme="http://blog.iavjkaede.com/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>ASP.NET ä¹‹ IISæ‰˜ç®¡çš„åå°ä»»åŠ¡</title>
    <link href="http://blog.iavjkaede.com/2019/06/01/ASP.NET%20Website%20Background%20Job/"/>
    <id>http://blog.iavjkaede.com/2019/06/01/ASP.NET%20Website%20Background%20Job/</id>
    <published>2019-06-01T04:39:00.000Z</published>
    <updated>2020-05-23T08:51:32.606Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ASP-NET-ä¹‹-IISæ‰˜ç®¡çš„åå°ä»»åŠ¡"><a href="#ASP-NET-ä¹‹-IISæ‰˜ç®¡çš„åå°ä»»åŠ¡" class="headerlink" title="ASP.NET ä¹‹ IISæ‰˜ç®¡çš„åå°ä»»åŠ¡"></a>ASP.NET ä¹‹ IISæ‰˜ç®¡çš„åå°ä»»åŠ¡</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>&emsp;&emsp;å¯èƒ½æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬å¸Œæœ›ç½‘ç«™åå°æ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨æ‰§è¡ŒæŸäº›ä»»åŠ¡ã€‚ç„¶è€Œåœ¨ç½‘ç«™éƒ¨ç½²åˆ°IISä¸Šçš„æƒ…å†µä¸‹ï¼Œç”±äºIISåº”ç”¨ç¨‹åºæ± è‡ªåŠ¨å›æ”¶çš„åŸå› ï¼Œå¯¼è‡´ä»»åŠ¡ä¸­æ–­ï¼Œæ— æ³•ä¸€ç›´ä¿æŒåå°è¿è¡Œã€‚</p><p>â€‹        ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ‰¾å‡ºä¸€ä¸ªè§£å†³æ–¹æ³•ã€‚å—¯ã€‚</p><h2 id="ç¯å¢ƒç®€ä»‹"><a href="#ç¯å¢ƒç®€ä»‹" class="headerlink" title="ç¯å¢ƒç®€ä»‹"></a>ç¯å¢ƒç®€ä»‹</h2><p>è¿™é‡Œæ˜¯æˆ‘åœ¨åšè¿™ä»¶äº‹æƒ…æ—¶çš„ä¸€ä¸ªéƒ¨ç½²å’Œå¼€å‘æ‰€ä½¿ç”¨çš„ç¯å¢ƒã€‚</p><h3 id="ç³»ç»Ÿç¯å¢ƒ"><a href="#ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒ"></a>ç³»ç»Ÿç¯å¢ƒ</h3><p>Windows 10 1903</p><h3 id="å¼€å‘ç¯å¢ƒ"><a href="#å¼€å‘ç¯å¢ƒ" class="headerlink" title="å¼€å‘ç¯å¢ƒ"></a>å¼€å‘ç¯å¢ƒ</h3><p>å·¥å…·ï¼šVisual Studio 2019</p><p>SDKï¼š.Netframework 4.6.2 </p><h3 id="éƒ¨ç½²ç¯å¢ƒ"><a href="#éƒ¨ç½²ç¯å¢ƒ" class="headerlink" title="éƒ¨ç½²ç¯å¢ƒ"></a>éƒ¨ç½²ç¯å¢ƒ</h3><p>IIS Express</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="åˆ©ç”¨å®šæ—¶å™¨å®ç°åå°ä»»åŠ¡"><a href="#åˆ©ç”¨å®šæ—¶å™¨å®ç°åå°ä»»åŠ¡" class="headerlink" title="åˆ©ç”¨å®šæ—¶å™¨å®ç°åå°ä»»åŠ¡"></a>åˆ©ç”¨å®šæ—¶å™¨å®ç°åå°ä»»åŠ¡</h3><p><strong>JobManager.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JobManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Timer m_timer;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">JobManager</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">         m_timer = <span class="keyword">new</span> Timer(<span class="keyword">new</span> TimerCallback(TimerCallback));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">TimerCallback</span>(<span class="params"><span class="keyword">object</span> target</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// do work here</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// interval 1 min </span></span><br><span class="line">        m_timer.Change(TimeSpan.Zero, TimeSpan.FromMinutes(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><p><code>JobManager.Start();</code></p><p>æœ‰å…³Timerçš„ç”¨æ³• å¯å‚è€ƒMSDN</p><p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.threading.timer?f1url=https%3A%2F%2Fmsdn.microsoft.com%2Fquery%2Fdev15.query%3FappId%3DDev15IDEF1%26l%3DZH-CN%26k%3Dk(System.Threading.Timer);k(TargetFrameworkMoniker-.NETFramework,Version%3Dv4.6.2);k(DevLang-csharp)%26rd%3Dtrue&view=netframework-4.8" target="_blank" rel="noopener">Timer Class</a></p><p><strong>è¿™æ ·å®ç°çš„ä»»åŠ¡æœ‰ä¸ªè‡´å‘½ç¼ºé™·ï¼ŒIIS åº”ç”¨ç¨‹åºæ± è‡ªåŠ¨å›æ”¶çš„æ—¶å€™ä¼šæ¯«ä¸ç•™æƒ…çš„å°†å…¶æ‘§æ¯ã€‚</strong></p><p>ä¸‹é¢æœ‰ä¸¤ç§å¼‚æ›²åŒå·¥çš„è§£å†³æ–¹å¼ã€‚</p><hr><h3 id="Application-End-ä¸­å”¤é†’-IIS"><a href="#Application-End-ä¸­å”¤é†’-IIS" class="headerlink" title="Application_End ä¸­å”¤é†’ IIS"></a>Application_End ä¸­å”¤é†’ IIS</h3><p>â€‹    åº”ç”¨ç¨‹åºæ± è¿›è¡Œå›æ”¶çš„æ—¶å€™ä¼šè°ƒç”¨<em>Application_End</em> æ–¹æ³•ï¼Œæ‰€ä»¥ï¼Œåœ¨è¿™é‡Œç»§ç»­å°†IISå”¤é†’å³å¯ã€‚</p><p>â€‹    æˆ‘æŠŠå…³é”®çš„ä»£ç æ”¾åœ¨è¿™é‡Œ</p><p><strong>Global.asax.cs</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Application_End</span>(<span class="params"><span class="keyword">object</span> sender,EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ä»è¿™é‡Œå”¤é†’ä½ çš„ç½‘ç«™ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¾—åˆ°ç½‘ç«™çš„åœ°å€</span></span><br><span class="line">    <span class="keyword">string</span> url = <span class="string">"http://www.yousite.com"</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">          <span class="keyword">using</span>(HttpClient client = <span class="keyword">new</span> HttpClient())</span><br><span class="line">          &#123;</span><br><span class="line"> <span class="keyword">var</span> response = <span class="keyword">await</span> client.GetAsync(url);</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(Exception)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†å¯èƒ½å‡ºç°çš„å¼‚å¸¸</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯èƒ½è¿˜éœ€è¦å†™ä¸ªæ—¥å¿—æ¥è®°å½•æƒ…å†µæˆ–è€…ç”¨<em>HttpWebRequest</em>æ¥å‘èµ·è¯·æ±‚ï¼Œéƒ½æ²¡é—®é¢˜ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸€ç§æ–¹å¼ã€‚</p><hr><h3 id="IRegisteredObject-å”¤é†’IIS"><a href="#IRegisteredObject-å”¤é†’IIS" class="headerlink" title="IRegisteredObject å”¤é†’IIS"></a>IRegisteredObject å”¤é†’IIS</h3><h4 id="IRegisteredObject-æ¥å£"><a href="#IRegisteredObject-æ¥å£" class="headerlink" title="IRegisteredObject æ¥å£"></a>IRegisteredObject æ¥å£</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IRegisteredObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Stop</span>(<span class="params"><span class="keyword">bool</span> immediate</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    å®ƒæ˜¯åœ¨<code>System.Web.Hosting</code> ä¸‹çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒæ˜¯åšä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿ</p><p>æ¬è¿ä¸€ä¸‹MSDNçš„æè¿° ï¼š</p><hr><p><em>å¯ä»¥é€šè¿‡è°ƒç”¨åˆ›å»ºå·²æ³¨å†Œå¯¹è±¡çš„å®ä¾‹<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.web.hosting.applicationmanager.createobject?view=netframework-4.8" target="_blank" rel="noopener">ApplicationManager.CreateObject</a>çš„åº”ç”¨ç¨‹åºç®¡ç†å™¨ä¸­çš„æ–¹æ³•ã€‚ åº”ç”¨ç¨‹åºç®¡ç†å™¨å°†æ–°åˆ›å»ºçš„å¯¹è±¡è¿”å›ç»™è°ƒç”¨æ–¹ï¼Œç„¶ååœ¨å¯¹è±¡è°ƒç”¨ç‰¹å®šäºç±»å‹çš„æ–¹æ³•ã€‚ åœ¨å¯åŠ¨æœŸé—´ï¼Œå·²æ³¨å†Œçš„å¯¹è±¡åº”è°ƒç”¨<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.web.hosting.hostingenvironment.registerobject?view=netframework-4.8" target="_blank" rel="noopener">HostingEnvironment.RegisterObject</a>æ–¹æ³•ä»¥å®Œæˆæ³¨å†Œçš„å¯¹è±¡ã€‚</em></p><p><em>å½“åº”ç”¨ç¨‹åºç®¡ç†å™¨éœ€è¦åœæ­¢å·²æ³¨å†Œçš„å¯¹è±¡æ—¶ï¼Œå®ƒå°†è°ƒç”¨<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.web.hosting.iregisteredobject.stop?view=netframework-4.8" target="_blank" rel="noopener">Stop</a>æ–¹æ³•</em></p><p>æ˜¯çš„ï¼Œå¾ˆæŠ½è±¡ï¼Œåæ­£è¿™ä¸ªæè¿°æˆ‘æ˜¯çœ‹ä¸æ‡‚ã€‚</p><p>ç®€å•è¯´ä¸€ä¸‹ï¼Œå°±æ˜¯<strong>åº”ç”¨ç¨‹åºæ± å°†è¦å›æ”¶çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨Stopæ–¹æ³•</strong>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨Stopä¸­å®ç°ä¸Šé¢åŒæ ·çš„é€»è¾‘ã€‚</p><hr><h4 id="IRegisteredObject-ä½¿ç”¨"><a href="#IRegisteredObject-ä½¿ç”¨" class="headerlink" title="IRegisteredObject ä½¿ç”¨"></a>IRegisteredObject ä½¿ç”¨</h4><p>é¦–å…ˆè¦æœ‰ä¸€ä¸ªç±»ç»§æ‰¿è‡ª <code>IRegisteredObject</code></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JobHost</span>:<span class="title">IRegisteredObject</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">JobHost</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">HostingEnvironment.RegisterObject(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Stop</span>(<span class="params"><span class="keyword">bool</span> immediate</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// åœ¨è¿™é‡Œå”¤é†’IIS</span></span><br><span class="line">HostingEnvironment.UnregisterObject(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨JobHost ä¹‹å‰éœ€è¦è°ƒç”¨</p><p><code>HostingEnvironment.RegisterObject(this);</code> è¿›è¡Œæ³¨å†Œ</p><p>åœ¨Stop è¢«è°ƒç”¨æ—¶  è¦è°ƒç”¨</p><p><code>HostingEnvironment.UnregisterObject(this);</code> è¿›è¡Œåæ³¨å†Œ</p><hr><h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h3><p>é€šè¿‡ç¬¬äºŒç§è§£å†³æ–¹å¼å®ç°åå°ä»»åŠ¡çš„å®Œæ•´ä»£ç </p><h5 id="JobHost-cs"><a href="#JobHost-cs" class="headerlink" title="JobHost.cs"></a>JobHost.cs</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">JobHost</span> : <span class="title">IRegisteredObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="keyword">object</span> m_lock = <span class="keyword">new</span> <span class="keyword">object</span> ();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> m_shuttingDown;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JobHost</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        HostingEnvironment.RegisterObject (<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Stop</span> (<span class="params"><span class="keyword">bool</span> immediate</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">lock</span> (m_lock)</span><br><span class="line">        &#123;</span><br><span class="line">            m_shuttingDown = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        HostingEnvironment.UnregisterObject (<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¨‹åºæ± è¢«å›æ”¶çš„æ—¶å€™é‡æ–°å”¤é†’iis</span></span><br><span class="line">        JobManager.Wakeup ();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoWork</span> (<span class="params">Action work</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">lock</span> (m_lock)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (m_shuttingDown)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            work ();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="JobManager-cs"><a href="#JobManager-cs" class="headerlink" title="JobManager.cs"></a>JobManager.cs</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JobManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Timer m_timer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> JobHost m_jobHost = <span class="keyword">new</span> JobHost();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">JobManager</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">         m_timer = <span class="keyword">new</span> Timer(<span class="keyword">new</span> TimerCallback(TimerCallback));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">TimerCallback</span>(<span class="params"><span class="keyword">object</span> target</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        m_jobHost.DoWork(()=&gt;&#123;</span><br><span class="line">            <span class="comment">// do work here</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// interval 1 min </span></span><br><span class="line">        m_timer.Change(TimeSpan.Zero, TimeSpan.FromMinutes(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">         <span class="keyword">string</span> url = <span class="string">"www.yousite.com"</span>;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span>(HttpClient client = <span class="keyword">new</span> HttpClient())</span><br><span class="line">            &#123;</span><br><span class="line">               <span class="keyword">var</span> response = <span class="keyword">await</span> client.GetAsync(url);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å¤„ç†å¯èƒ½å‡ºç°çš„å¼‚å¸¸</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œè®²çš„ä¸å¤Ÿè¯¦ç»†ï¼Œå¦‚æœè¦å‚è€ƒæ›´å¤šç»†èŠ‚ï¼Œè¿™é‡Œè´´å‡ºå‚è€ƒçš„blog</p><p><a href="https://haacked.com/archive/2011/10/16/the-dangers-of-implementing-recurring-background-tasks-in-asp-net.aspx/" target="_blank" rel="noopener">The Dangers of Implementing Recurring Background Tasks In ASP.NET</a> </p><hr><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>â€‹    è¿™ç§æ–¹å¼çš„åŸç†å¾ˆç®€å•ï¼ŒIISå°±åƒä¸ªè´ªç¡çš„å­©å­ï¼Œå½“ä»–å¿«è¦æ‰“çŒç¡çš„æ—¶å€™ï¼Œä½ å°±æ‹æ‹ä»–çš„è„‘è¢‹ã€‚</p><p>   â€œ å˜¿ï¼Œå¥½å­©å­ï¼Œè¯¥å·¥ä½œäº†ã€‚â€</p><p>   æ²¡é”™ï¼Œå°±æ˜¯è¿™ä¹ˆæ®‹é…·ğŸ˜‚ã€‚</p><p><strong>å½“æˆ‘ä»¬éœ€è¦æŒç»­ç¨³å®šçš„æ‰§è¡Œåå°ä»»åŠ¡çš„æ—¶å€™ï¼Œæ›´å¥½çš„æ–¹å¼åº”è¯¥æ˜¯å†™ä¸€ä¸ªæœåŠ¡ç¨‹åºï¼Œæˆ–è€…æ§åˆ¶å°</strong></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.2cto.com/kf/201112/115331.html" target="_blank" rel="noopener">IIS è‡ªåŠ¨å›æ”¶å¯¼è‡´åå°å®šæ—¶å™¨å¤±æ•ˆçš„é—®é¢˜è§£å†³</a></p><p><a href="https://haacked.com/archive/2011/10/16/the-dangers-of-implementing-recurring-background-tasks-in-asp-net.aspx/" target="_blank" rel="noopener">The Dangers of Implementing Recurring Background Tasks In ASP.NET</a></p><p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.threading.timer?f1url=https%3A%2F%2Fmsdn.microsoft.com%2Fquery%2Fdev15.query%3FappId%3DDev15IDEF1%26l%3DZH-CN%26k%3Dk(System.Threading.Timer);k(TargetFrameworkMoniker-.NETFramework,Version%3Dv4.6.2);k(DevLang-csharp)%26rd%3Dtrue&view=netframework-4.8" target="_blank" rel="noopener">Timer Class</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ASP-NET-ä¹‹-IISæ‰˜ç®¡çš„åå°ä»»åŠ¡&quot;&gt;&lt;a href=&quot;#ASP-NET-ä¹‹-IISæ‰˜ç®¡çš„åå°ä»»åŠ¡&quot; class=&quot;headerlink&quot; title=&quot;ASP.NET ä¹‹ IISæ‰˜ç®¡çš„åå°ä»»åŠ¡&quot;&gt;&lt;/a&gt;ASP.NET ä¹‹ IISæ‰˜ç®¡çš„åå°ä»»åŠ¡&lt;/h1&gt;&lt;
      
    
    </summary>
    
    
      <category term=".NET" scheme="http://blog.iavjkaede.com/categories/NET/"/>
    
    
      <category term="IIS" scheme="http://blog.iavjkaede.com/tags/IIS/"/>
    
      <category term="Background Task" scheme="http://blog.iavjkaede.com/tags/Background-Task/"/>
    
      <category term="C#" scheme="http://blog.iavjkaede.com/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>å†…ç½‘SVNç©¿é€è¸©å‘</title>
    <link href="http://blog.iavjkaede.com/2019/03/03/SVN%20nat/"/>
    <id>http://blog.iavjkaede.com/2019/03/03/SVN%20nat/</id>
    <published>2019-03-02T16:00:00.000Z</published>
    <updated>2020-05-23T08:52:41.637Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è®°ä¸€æ¬¡SVN-å†…ç½‘ç©¿é€ä»£ç†"><a href="#è®°ä¸€æ¬¡SVN-å†…ç½‘ç©¿é€ä»£ç†" class="headerlink" title="è®°ä¸€æ¬¡SVN å†…ç½‘ç©¿é€ä»£ç†"></a>è®°ä¸€æ¬¡SVN å†…ç½‘ç©¿é€ä»£ç†</h1><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><p>ç¯å¢ƒæ˜¯è¿™æ ·çš„ï¼Œå†…ç½‘æœ‰ä¸€å°SVNæœåŠ¡å™¨ Sï¼Œä¸€å°èƒ½è®¿é—®å¤–ç½‘çš„ä¸»æœºAã€‚é¦–å…ˆï¼Œæˆ‘æ²¡æœ‰SVNæœåŠ¡å™¨çš„ç®¡ç†æƒé™ï¼Œåªèƒ½é€šè¿‡ä¸»æœºAå»è®¿é—® æœåŠ¡å™¨Sã€‚ç°åœ¨æˆ‘éœ€è¦é€šè¿‡å¤–ç½‘å»è®¿é—®å†…ç½‘çš„SVNæœåŠ¡ã€‚</p><p>æˆ‘çš„æ€è·¯æ˜¯ï¼Œç”¨ä¸»æœºA åä»£ æœåŠ¡å™¨S ï¼Œç„¶åä½¿ç”¨å†…ç½‘ç©¿é€æœåŠ¡å°†ä¸»æœºAæš´éœ²åœ¨å¤–ç½‘ä¸­ã€‚</p><p>æ‰€ä»¥éœ€è¦åšä»¥ä¸‹å‡†å¤‡</p><ol><li>æŒ‰ç…§åå‘ä»£ç†æœåŠ¡</li><li>é€‰æ‹©å†…ç½‘ç©¿é€æœåŠ¡</li></ol><p>è¿™é‡Œæˆ‘ç”¨nginx åšåå‘ä»£ç†ï¼Œç”¨Natapp åšå†…ç½‘ç©¿é€ï¼ŒNatapp æ˜¯æ”¶è´¹ï¼ˆå…è´¹çš„é€šé“åŸŸåä¼šéš”æ®µæ—¶é—´å˜åŠ¨ï¼Œä¸å«Œå¼ƒéº»çƒ¦å¯ä»¥ç”¨ï¼‰çš„ä¸”éœ€è¦å®åè®¤è¯ï¼Œå¦‚æœè§‰å¾—ä¸é€‚ç”¨å¯ä»¥æœ‰è‡ªå·±æœåŠ¡å™¨çš„è¯å¯ä»¥è‡ªè¡Œæ­å»ºå†…ç½‘ç©¿é€æœåŠ¡ï¼Œè¿™é‡Œä¸å¤šè¯´ã€‚</p><p>è¯´ä¸€ä¸‹æˆ‘çš„Aä¸»æœºå…·ä½“ç¯å¢ƒ</p><p>Win 10 1903</p><p>WSL Debian 9</p><p>æˆ‘é€‰æ‹©ç”¨WSL æ¥åšè¿™ä¸€åˆ‡ï¼Œåœ¨è¿™é‡Œé¢è·‘æœåŠ¡å†å¥½ä¸è¿‡äº†ã€‚</p><h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><p>ç°åœ¨å¼€å§‹è¯¦ç»†çš„è¯´ä¸€ä¸‹ï¼Œè¿™é‡Œé¢æœ‰å‘ï¼Œéœ€è¦ç•™æ„</p><h3 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h3><p>é¦–å…ˆå®‰è£…nginx </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><p>å¯ç”¨ nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx start</span><br></pre></td></tr></table></figure><p>é…ç½®åä»£</p><p>æˆ‘ä»¬åœ¨<code>/etc/nginx/conf.d</code> ä¸­å»ºç«‹ä¸€ä¸ªé…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim svnproxy.conf</span><br></pre></td></tr></table></figure><p>è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œæˆ‘åšè¯¦ç»†è§£é‡Š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">listen</span> <span class="number">7777</span>;<span class="comment"># nginx ç›‘å¬çš„ç«¯å£å·ï¼Œåä»£çš„æœåŠ¡é€šè¿‡æ­¤ç«¯å£å‘å¤–æœåŠ¡</span></span><br><span class="line">        <span class="attribute">server_name</span> localhost;</span><br><span class="line">        <span class="attribute">location</span> /&#123;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">                <span class="attribute">set</span> <span class="variable">$fixed_destination</span> <span class="variable">$http_destination</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è¿™ä¸ªåœ°æ–¹å¾ˆé‡è¦ï¼Œå‘åœ¨è¿™ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡ http åè®®æ¥è®¿é—®æˆ‘ä»¬</span></span><br><span class="line">        <span class="comment"># çš„ä¸»æœºAï¼Œè€Œä¸»æœºA éœ€è¦é€šè¿‡httpsåè®®è®¿é—®SVNæœåŠ¡å™¨</span></span><br><span class="line">        <span class="comment"># é‚£ä¹ˆéœ€è¦å‘ä¸‹é¢ä¸‰è¡Œè¿™æ ·å†™</span></span><br><span class="line">                <span class="attribute">if</span> ( <span class="variable">$http_destination</span> <span class="regexp">~* ^http(.*)$</span> ) &#123;</span><br><span class="line">                <span class="attribute">set</span> <span class="variable">$fixed_destination</span> https<span class="variable">$1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åä¹‹ï¼Œå¦‚æœä½ é€šè¿‡httpsåè®®è®¿é—®ä¸»æœºAï¼Œé€šè¿‡httpåè®®è®¿é—® SVNæœåŠ¡å™¨</span></span><br><span class="line">        <span class="comment"># éœ€è¦åƒè¿™ä¹ˆå†™ï¼ŒåŒºåˆ«å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä¸å†å¤šè¯´</span></span><br><span class="line">            <span class="comment">#if ( $http_destination ~* ^https(.*)$ ) &#123;</span></span><br><span class="line">                <span class="comment">#set $fixed_destination http$1;</span></span><br><span class="line">                <span class="comment">#&#125;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ä¸åƒä¸Šé¢åšä¼šå‡ºä»€ä¹ˆé—®é¢˜å‘¢ï¼Œé—®é¢˜å°±æ˜¯ï¼Œå¤–ç½‘é€šè¿‡ä¸»æœºAå¯ä»¥æ­£å¸¸è¿›è¡ŒUpdateï¼Œä½†æ˜¯æ— æ³•Commitï¼ŒåŸå› å¤§è‡´æ˜¯http COPY PUT ä¹‹ç±»çš„æ“ä½œç»è¿‡åä»£æ— æ³•æ­£ç¡®æ‰§è¡Œã€‚</span></span><br><span class="line">        </span><br><span class="line">                <span class="attribute">proxy_set_header</span> Destination <span class="variable">$fixed_destination</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¦åä»£çš„SVNæœåŠ¡å™¨åœ°å€ï¼Œç¡®ä¿SVNæœåŠ¡èƒ½æä¾›Https è®¿é—®</span></span><br><span class="line">                <span class="attribute">proxy_pass</span>      https://192.168.0.2;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®å¥½ä¿å­˜æˆ‘ä»¬é‡è½½ä¸‹nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t &amp;&amp; nginx -s reload</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨æœ¬åœ°é€šè¿‡æµè§ˆå™¨ è®¿é—®A ä¸»æœºçš„<code>7777</code> ç«¯å£çœ‹ä¸€ä¸‹ï¼Œç”¨SVNåœ¨æœ¬åœ°æµ‹è¯•ä»¥ä¸‹ä¹ŸOk</p><h3 id="ç©¿é€"><a href="#ç©¿é€" class="headerlink" title="ç©¿é€"></a>ç©¿é€</h3><p>ç©¿é€çš„è¿‡ç¨‹æˆ‘å°±ä¸åœ¨è¯¦ç»†è®²äº†ã€‚åœ¨Natapp ä¸Šå¼€æ¡éš§é“ï¼ŒwebæœåŠ¡ç”¨çš„ï¼Œç„¶åä¸‹è½½å®ƒçš„ç¨‹åºåœ¨WLSå¯åŠ¨ï¼Œç½‘ç«™ä¸Šéƒ½ç”¨æ€ä¹ˆç”¨å“ˆï¼Œä»£ç†ç«¯å£å·å¡«å†™ä¸Šé¢é…ç½®çš„ç«¯å£å·å°±å¯ä»¥äº†ã€‚é¿å…éº»çƒ¦çš„è¯å¯ä»¥ä¹°ä¸ªæ”¶è´¹çš„éš§é“ï¼Œä»·æ ¼å¯ä»¥ï¼Œä¸»è¦æœ‰å›ºå®šåŸŸåã€‚è¦è¯´ä¸€ç‚¹çš„æ˜¯ï¼Œå¯ä»¥ç”¨Supervisor åšä¸ªè¿›ç¨‹å®ˆæŠ¤ï¼Œç„¶åé…ç½®ä¸‹å¼€æœºè‡ªå¯ï¼ˆæˆ‘æœ‰å†™è¿‡è¿™ä¸ªçš„ï¼‰ï¼Œå®Œç¾ã€‚</p><h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>æœ‰ä¸ªå‘æˆ‘ä¸€å®šè¦è®²ä¸€ä¸‹ï¼Œæˆ‘åœ¨ä¸»æœºAä¸Šä½¿ç”¨SVNæœåŠ¡ä¸€åˆ‡æ­£å¸¸ï¼Œç„¶ååä»£åé€šè¿‡å¤–ç½‘è®¿é—®SVNï¼Œå‘ç°é‡å‘½åçš„æ–‡ä»¶æ²¡åŠæ³•æäº¤äº†ã€‚ç»è¿‡ä¸€ç•ªæŠ˜ç£¨ç»ˆäºæ‰¾åˆ°äº†é—®é¢˜ï¼Œé‚£å°±æ˜¯<strong>SVN ä»“åº“æ–‡ä»¶å¤¹ä¸­æœ‰ä¸­æ–‡å­—ç¬¦</strong>ï¼Œå¾ˆå‘ï¼Œæ‰€ä»¥SVNä»“åº“é‡Œæœ€å¥½ä¸è¦å‡ºç°ä¸­æ–‡è·¯å¾„ã€‚</p><p>åˆ°æ­¤ï¼Œå‘Šä¸€æ®µè½ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;è®°ä¸€æ¬¡SVN-å†…ç½‘ç©¿é€ä»£ç†&quot;&gt;&lt;a href=&quot;#è®°ä¸€æ¬¡SVN-å†…ç½‘ç©¿é€ä»£ç†&quot; class=&quot;headerlink&quot; title=&quot;è®°ä¸€æ¬¡SVN å†…ç½‘ç©¿é€ä»£ç†&quot;&gt;&lt;/a&gt;è®°ä¸€æ¬¡SVN å†…ç½‘ç©¿é€ä»£ç†&lt;/h1&gt;&lt;h2 id=&quot;å‡†å¤‡&quot;&gt;&lt;a href=&quot;#å‡†å¤‡&quot; cla
      
    
    </summary>
    
    
      <category term="Deploy" scheme="http://blog.iavjkaede.com/categories/Deploy/"/>
    
    
      <category term="Deploy" scheme="http://blog.iavjkaede.com/tags/Deploy/"/>
    
      <category term="NAT" scheme="http://blog.iavjkaede.com/tags/NAT/"/>
    
  </entry>
  
  <entry>
    <title>Linuxå­ç³»ç»Ÿ(WSL)ä¸­çš„æœåŠ¡å¼€æœºå¯åŠ¨</title>
    <link href="http://blog.iavjkaede.com/2019/03/02/WSL%20Service%20Autostart/"/>
    <id>http://blog.iavjkaede.com/2019/03/02/WSL%20Service%20Autostart/</id>
    <published>2019-03-02T04:24:00.000Z</published>
    <updated>2020-05-23T08:52:49.205Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒç®€ä»‹"><a href="#ç¯å¢ƒç®€ä»‹" class="headerlink" title="ç¯å¢ƒç®€ä»‹"></a>ç¯å¢ƒç®€ä»‹</h2><h3 id="ç³»ç»Ÿç¯å¢ƒ"><a href="#ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒ"></a>ç³»ç»Ÿç¯å¢ƒ</h3><p>å¼€äº†WSL çš„<strong>Windows LTSC 2019</strong> </p><p>WSL ï¼š <strong>Debian å‘è¡Œç‰ˆ</strong></p><h3 id="Shell-ç¯å¢ƒ"><a href="#Shell-ç¯å¢ƒ" class="headerlink" title="Shell ç¯å¢ƒ"></a>Shell ç¯å¢ƒ</h3><p>WSL Shell  ä½¿ç”¨ <strong>ZSH</strong></p><h2 id="ç®€çŸ­æˆªè¯´"><a href="#ç®€çŸ­æˆªè¯´" class="headerlink" title="ç®€çŸ­æˆªè¯´"></a>ç®€çŸ­æˆªè¯´</h2><p>è¿™ä¸ªè§£å†³æ–¹å¼æ˜¯åœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°çš„ï¼Œè¿™é‡Œä»…ä»…æ˜¯æ¬è¿ä¸€ä¸‹ï¼Œåšä¸ªè®°å½•ã€‚</p><p><a href="https://zhuanlan.zhihu.com/p/47733615" target="_blank" rel="noopener">WSL æœåŠ¡è‡ªåŠ¨å¯åŠ¨çš„æ­£ç¡®æ–¹æ³•</a></p><h3 id="åˆ›å»ºå¹¶ç¼–è¾‘init-wsl"><a href="#åˆ›å»ºå¹¶ç¼–è¾‘init-wsl" class="headerlink" title="åˆ›å»ºå¹¶ç¼–è¾‘init.wsl"></a>åˆ›å»ºå¹¶ç¼–è¾‘init.wsl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/init.wsl</span><br></pre></td></tr></table></figure><p><strong>init.wsl</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/sh</span></span><br><span class="line"></span><br><span class="line">/etc/init.d/ssh <span class="variable">$1</span></span><br><span class="line">/etc/init.d/supervisor <span class="variable">$1</span></span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®æƒé™"><a href="#è®¾ç½®æƒé™" class="headerlink" title="è®¾ç½®æƒé™"></a>è®¾ç½®æƒé™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chown root:root /etc/init.wsl</span><br><span class="line">sudo chmod +x /etc/init.wsl</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºVBSè„šæœ¬"><a href="#åˆ›å»ºVBSè„šæœ¬" class="headerlink" title="åˆ›å»ºVBSè„šæœ¬"></a>åˆ›å»ºVBSè„šæœ¬</h3><p>åœ¨Windows ä¸­ <code>Win+R</code> è¿è¡Œ <code>shell :startup</code></p><p>åœ¨å¼¹å‡ºçš„ç›®å½•ä¸­åˆ›å»º<code>debian.vbs</code>ï¼Œå¦‚æœä½ ç”¨çš„åˆ«çš„å‘è¡Œç‰ˆï¼Œæ¯”å¦‚ubuntu18.04ï¼Œæ–‡ä»¶åå°±æ˜¯<code>ubuntu1804.vbs</code></p><p>å¦‚æœä¸çŸ¥é“è‡ªå·±çš„å‘è¡Œç‰ˆåç§°å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">-l</span></span><br></pre></td></tr></table></figure><p><em>è¿™æ¡å‘½ä»¤æ˜¯åœ¨ï¼·idowsç»ˆç«¯ä¸­æ‰§è¡Œè€Œéåœ¨WSLä¸­ï¼Œåœ¨æˆ‘çš„ç³»ç»Ÿï¼ˆLTSC 2019)ä¸­è¿™æ¡å‘½ä»¤å¹¶éæœ‰æ•ˆ</em></p><p>æˆ–è€…å¯ä»¥å°è¯•è¿™ä¸ªå‘½ä»¤</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wslconfig /l</span><br></pre></td></tr></table></figure><h3 id="ç¼–è¾‘VBSè„šæœ¬"><a href="#ç¼–è¾‘VBSè„šæœ¬" class="headerlink" title="ç¼–è¾‘VBSè„šæœ¬"></a>ç¼–è¾‘VBSè„šæœ¬</h3><p><strong>debian.vbs</strong></p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Set</span> ws = <span class="built_in">CreateObject</span>(<span class="string">"Wscript.Shell"</span>)</span><br><span class="line">ws.run <span class="string">"wsl -d debian -u root /etc/init.wsl start"</span>, vbhide</span><br></pre></td></tr></table></figure><p>ä¿å­˜æ–‡ä»¶åï¼Œæ‰€æœ‰çš„æ­¥éª¤å°±éƒ½è¿›è¡Œå®Œäº†ã€‚</p><h2 id="åŸæ–‡é“¾æ¥"><a href="#åŸæ–‡é“¾æ¥" class="headerlink" title="åŸæ–‡é“¾æ¥"></a>åŸæ–‡é“¾æ¥</h2><p><a href="https://zhuanlan.zhihu.com/p/47733615" target="_blank" rel="noopener">WSL æœåŠ¡è‡ªåŠ¨å¯åŠ¨çš„æ­£ç¡®æ–¹æ³•</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç¯å¢ƒç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒç®€ä»‹&quot;&gt;&lt;/a&gt;ç¯å¢ƒç®€ä»‹&lt;/h2&gt;&lt;h3 id=&quot;ç³»ç»Ÿç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#ç³»ç»Ÿç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;ç³»ç»Ÿç¯å¢ƒ&quot;&gt;&lt;/a
      
    
    </summary>
    
    
      <category term="Deploy" scheme="http://blog.iavjkaede.com/categories/Deploy/"/>
    
    
      <category term="WSL" scheme="http://blog.iavjkaede.com/tags/WSL/"/>
    
      <category term="Debian" scheme="http://blog.iavjkaede.com/tags/Debian/"/>
    
  </entry>
  
</feed>
